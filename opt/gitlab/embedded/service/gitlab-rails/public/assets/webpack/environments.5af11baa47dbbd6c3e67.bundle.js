webpackJsonp([6,25,26],{"3qMg":function(n,e,t){var o=t("Eruj"),a=t("j4Jp");t("A+3H"),t("zp3R");var l=t("R8Dz"),i=t("AhTQ"),s=t("kXVd"),r=t("FaWK"),m=t("Q/iC"),d=new a;n.exports=o.component("environment-item",{components:{"commit-component":gl.CommitComponent,"actions-component":l,"external-url-component":i,"stop-component":s,"rollback-component":r,"terminal-button-component":m},props:{model:{type:Object,required:!0,default:function(){return{}}},canCreateDeployment:{type:Boolean,required:!1,default:!1},canReadEnvironment:{type:Boolean,required:!1,default:!1}},computed:{hasLastDeploymentKey:function(){return!(!this.model||!this.model.last_deployment||this.$options.isObjectEmpty(this.model.last_deployment))},hasManualActions:function(){return this.model&&this.model.last_deployment&&this.model.last_deployment.manual_actions&&this.model.last_deployment.manual_actions.length>0},hasStopAction:function(){return this.model&&this.model["stop_action?"]},canRetry:function(){return this.model&&this.hasLastDeploymentKey&&this.model.last_deployment&&this.model.last_deployment.deployable},canShowDate:function(){return this.model&&this.model.last_deployment&&this.model.last_deployment.deployable&&void 0!==this.model.last_deployment.deployable},createdDate:function(){return this.model&&this.model.last_deployment&&this.model.last_deployment.deployable&&this.model.last_deployment.deployable.created_at?d.format(this.model.last_deployment.deployable.created_at):""},manualActions:function(){return this.hasManualActions?this.model.last_deployment.manual_actions.map(function(n){var e={name:gl.text.humanize(n.name),play_path:n.play_path};return e}):[]},userImageAltDescription:function(){return this.model&&this.model.last_deployment&&this.model.last_deployment.user&&this.model.last_deployment.user.username?this.model.last_deployment.user.username+"'s avatar'":""},commitTag:function(){if(this.model&&this.model.last_deployment&&this.model.last_deployment.tag)return this.model.last_deployment.tag},commitRef:function(){if(this.model&&this.model.last_deployment&&this.model.last_deployment.ref)return this.model.last_deployment.ref},commitUrl:function(){if(this.model&&this.model.last_deployment&&this.model.last_deployment.commit&&this.model.last_deployment.commit.commit_path)return this.model.last_deployment.commit.commit_path},commitShortSha:function(){if(this.model&&this.model.last_deployment&&this.model.last_deployment.commit&&this.model.last_deployment.commit.short_id)return this.model.last_deployment.commit.short_id},commitTitle:function(){if(this.model&&this.model.last_deployment&&this.model.last_deployment.commit&&this.model.last_deployment.commit.title)return this.model.last_deployment.commit.title},commitAuthor:function(){if(this.model&&this.model.last_deployment&&this.model.last_deployment.commit&&this.model.last_deployment.commit.author)return this.model.last_deployment.commit.author},retryUrl:function(){if(this.model&&this.model.last_deployment&&this.model.last_deployment.deployable&&this.model.last_deployment.deployable.retry_path)return this.model.last_deployment.deployable.retry_path},isLastDeployment:function(){return this.model&&this.model.last_deployment&&this.model.last_deployment["last?"]},buildName:function(){return this.model&&this.model.last_deployment&&this.model.last_deployment.deployable?this.model.last_deployment.deployable.name+" #"+this.model.last_deployment.deployable.id:""},deploymentInternalId:function(){return this.model&&this.model.last_deployment&&this.model.last_deployment.iid?"#"+this.model.last_deployment.iid:""},deploymentHasUser:function(){return this.model&&!this.$options.isObjectEmpty(this.model.last_deployment)&&!this.$options.isObjectEmpty(this.model.last_deployment.user)},deploymentUser:function(){return!this.model||this.$options.isObjectEmpty(this.model.last_deployment)||this.$options.isObjectEmpty(this.model.last_deployment.user)?{}:this.model.last_deployment.user},shouldRenderBuildName:function(){return!this.model.isFolder&&!this.$options.isObjectEmpty(this.model.last_deployment)&&!this.$options.isObjectEmpty(this.model.last_deployment.deployable)},buildPath:function(){return this.model&&this.model.last_deployment&&this.model.last_deployment.deployable&&this.model.last_deployment.deployable.build_path?this.model.last_deployment.deployable.build_path:""},externalURL:function(){return this.model&&this.model.external_url?this.model.external_url:""},shouldRenderDeploymentID:function(){return!this.model.isFolder&&!this.$options.isObjectEmpty(this.model.last_deployment)&&void 0!==this.model.last_deployment.iid},environmentPath:function(){return this.model&&this.model.environment_path?this.model.environment_path:""},folderUrl:function(){return window.location.pathname+"/folders/"+this.model.folderName}},isObjectEmpty:function(n){for(var e in n)if(hasOwnProperty.call(n,e))return!1;return!0},template:'\n    <tr>\n      <td>\n        <a v-if="!model.isFolder"\n          class="environment-name"\n          :href="environmentPath">\n          {{model.name}}\n        </a>\n        <a v-else class="folder-name" :href="folderUrl">\n          <span class="folder-icon">\n            <i class="fa fa-folder" aria-hidden="true"></i>\n          </span>\n\n          <span>\n            {{model.folderName}}\n          </span>\n\n          <span class="badge">\n            {{model.size}}\n          </span>\n        </a>\n      </td>\n\n      <td class="deployment-column">\n        <span v-if="shouldRenderDeploymentID">\n          {{deploymentInternalId}}\n        </span>\n\n        <span v-if="!model.isFolder && deploymentHasUser">\n          by\n          <a :href="deploymentUser.web_url" class="js-deploy-user-container">\n            <img class="avatar has-tooltip s20"\n              :src="deploymentUser.avatar_url"\n              :alt="userImageAltDescription"\n              :title="deploymentUser.username" />\n          </a>\n        </span>\n      </td>\n\n      <td class="environments-build-cell">\n        <a v-if="shouldRenderBuildName"\n          class="build-link"\n          :href="buildPath">\n          {{buildName}}\n        </a>\n      </td>\n\n      <td>\n        <div v-if="!model.isFolder && hasLastDeploymentKey" class="js-commit-component">\n          <commit-component\n            :tag="commitTag"\n            :commit-ref="commitRef"\n            :commit-url="commitUrl"\n            :short-sha="commitShortSha"\n            :title="commitTitle"\n            :author="commitAuthor"/>\n        </div>\n        <p v-if="!model.isFolder && !hasLastDeploymentKey" class="commit-title">\n          No deployments yet\n        </p>\n      </td>\n\n      <td>\n        <span v-if="!model.isFolder && canShowDate"\n          class="environment-created-date-timeago">\n          {{createdDate}}\n        </span>\n      </td>\n\n      <td class="environments-actions">\n        <div v-if="!model.isFolder" class="btn-group pull-right" role="group">\n          <actions-component v-if="hasManualActions && canCreateDeployment"\n            :actions="manualActions"/>\n\n          <external-url-component v-if="externalURL && canReadEnvironment"\n            :external-url="externalURL"/>\n\n          <stop-component v-if="hasStopAction && canCreateDeployment"\n            :stop-url="model.stop_path"/>\n\n          <terminal-button-component v-if="model && model.terminal_path"\n            :terminal-path="model.terminal_path"/>\n\n          <rollback-component v-if="canRetry && canCreateDeployment"\n            :is-last-deployment="isLastDeployment"\n            :retry-url="retryUrl"/>\n        </div>\n      </td>\n    </tr>\n  '})},AhTQ:function(n,e,t){var o=t("Eruj");n.exports=o.component("external-url-component",{props:{externalUrl:{type:String,default:""}},template:'\n    <a class="btn external_url" :href="externalUrl" target="_blank" rel="noopener noreferrer">\n      <i class="fa fa-external-link"></i>\n    </a>\n  '})},FaWK:function(n,e,t){var o=t("Eruj");n.exports=o.component("rollback-component",{props:{retryUrl:{type:String,default:""},isLastDeployment:{type:Boolean,default:!0}},template:'\n    <a class="btn" :href="retryUrl" data-method="post" rel="nofollow">\n      <span v-if="isLastDeployment">\n        Re-deploy\n      </span>\n      <span v-else>\n        Rollback\n      </span>\n    </a>\n  '})},"Q/iC":function(n,e,t){var o=t("Eruj"),a=t("WEra");n.exports=o.component("terminal-button-component",{props:{terminalPath:{type:String,default:""}},data:function(){return{terminalIconSvg:a}},template:'\n    <a class="btn terminal-button"\n      :href="terminalPath">\n      '+a+"\n    </a>\n  "})},R8Dz:function(n,e,t){var o=t("Eruj"),a=t("LIwm");n.exports=o.component("actions-component",{props:{actions:{type:Array,required:!1,default:function(){return[]}}},data:function(){return{playIconSvg:a}},template:'\n    <div class="btn-group" role="group">\n      <button class="dropdown btn btn-default dropdown-new" data-toggle="dropdown">\n        <span>\n          <span class="js-dropdown-play-icon-container" v-html="playIconSvg"></span>\n          <i class="fa fa-caret-down"></i>\n        </span>\n\n      <ul class="dropdown-menu dropdown-menu-align-right">\n        <li v-for="action in actions">\n          <a :href="action.play_path"\n            data-method="post"\n            rel="nofollow"\n            class="js-manual-action-link">\n            '+a+"\n            <span>\n              {{action.name}}\n            </span>\n          </a>\n        </li>\n      </ul>\n    </button>\n  </div>\n  "})},WEra:function(n,e){n.exports='<svg width="19" height="14" viewBox="0 0 19 14" xmlns="http://www.w3.org/2000/svg"><rect fill="#848484" x="7.2" y="9.25" width="6.46" height="1.5" rx=".5"/><path d="M5.851 7.016L3.81 9.103a.503.503 0 0 0 .017.709l.35.334c.207.198.524.191.717-.006l2.687-2.748a.493.493 0 0 0 .137-.376.493.493 0 0 0-.137-.376L4.894 3.892a.507.507 0 0 0-.717-.006l-.35.334a.503.503 0 0 0-.017.709L5.85 7.016z"/><path d="M1.25 11.497c0 .691.562 1.253 1.253 1.253h13.994c.694 0 1.253-.56 1.253-1.253V2.503c0-.691-.562-1.253-1.253-1.253H2.503c-.694 0-1.253.56-1.253 1.253v8.994zM2.503 0h13.994A2.504 2.504 0 0 1 19 2.503v8.994A2.501 2.501 0 0 1 16.497 14H2.503A2.504 2.504 0 0 1 0 11.497V2.503A2.501 2.501 0 0 1 2.503 0z"/></svg>\n'},"XJ/8":function(n,e,t){(function(n){var e=t("vm9i");n(function(){window.gl=window.gl||{},gl.EnvironmentsListApp&&gl.EnvironmentsListApp.$destroy(!0),gl.EnvironmentsListApp=new e({el:document.querySelector("#environments-list-view")})})}).call(e,t("lwLq"))},jNb8:function(n,e,t){var o=t("Eruj"),a=t("3qMg");n.exports=o.component("environment-table-component",{components:{"environment-item":a},props:{environments:{type:Array,required:!0,default:function(){return[]}},canReadEnvironment:{type:Boolean,required:!1,default:!1},canCreateDeployment:{type:Boolean,required:!1,default:!1}},template:'\n    <table class="table ci-table">\n      <thead>\n        <tr>\n          <th class="environments-name">Environment</th>\n          <th class="environments-deploy">Last deployment</th>\n          <th class="environments-build">Job</th>\n          <th class="environments-commit">Commit</th>\n          <th class="environments-date">Updated</th>\n          <th class="environments-actions"></th>\n        </tr>\n      </thead>\n      <tbody>\n        <template v-for="model in environments"\n          v-bind:model="model">\n          <tr is="environment-item"\n            :model="model"\n            :can-create-deployment="canCreateDeployment"\n            :can-read-environment="canReadEnvironment"></tr>\n        </template>\n      </tbody>\n    </table>\n  '})},kXVd:function(n,e,t){var o=t("Eruj");n.exports=o.component("stop-component",{props:{stopUrl:{type:String,default:""}},template:'\n    <a class="btn stop-env-link"\n      :href="stopUrl"\n      data-confirm="Are you sure you want to stop this environment?"\n      data-method="post"\n      rel="nofollow">\n      <i class="fa fa-stop stop-env-icon" aria-hidden="true"></i>\n    </a>\n  '})},pGP2:function(n,e,t){function o(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var a=function(){function n(n,e){for(var t=0;t<e.length;t++){var o=e[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}}return function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}}(),l=t("Eruj"),i=function(){function n(e){o(this,n),this.environments=l.resource(e)}return a(n,[{key:"get",value:function(){return this.environments.get()}}]),n}();n.exports=i},vm9i:function(n,e,t){var o=window.Vue=t("Eruj");window.Vue.use(t("7UJR"));var a=t("pGP2"),l=t("jNb8"),i=t("w+iT");t("03o2"),t("RsTm"),t("wFzz"),n.exports=o.component("environment-component",{components:{"environment-table":l,"table-pagination":gl.VueGlPagination},data:function(){var n=document.querySelector("#environments-list-view").dataset,e=new i;return{store:e,state:e.state,visibility:"available",isLoading:!1,cssContainerClass:n.cssClass,endpoint:n.environmentsDataEndpoint,canCreateDeployment:n.canCreateDeployment,canReadEnvironment:n.canReadEnvironment,canCreateEnvironment:n.canCreateEnvironment,projectEnvironmentsPath:n.projectEnvironmentsPath,projectStoppedEnvironmentsPath:n.projectStoppedEnvironmentsPath,newEnvironmentPath:n.newEnvironmentPath,helpPagePath:n.helpPagePath,paginationInformation:{},pageNumber:1}},computed:{scope:function(){return gl.utils.getParameterByName("scope")},canReadEnvironmentParsed:function(){return gl.utils.convertPermissionToBoolean(this.canReadEnvironment)},canCreateDeploymentParsed:function(){return gl.utils.convertPermissionToBoolean(this.canCreateDeployment)},canCreateEnvironmentParsed:function(){return gl.utils.convertPermissionToBoolean(this.canCreateEnvironment)}},created:function(){var n=this,e=gl.utils.getParameterByName("scope")||this.visibility,t=gl.utils.getParameterByName("page")||this.pageNumber,o=this.endpoint+"?scope="+e+"&page="+t,l=new a(o);return this.isLoading=!0,l.get().then(function(n){return{headers:n.headers,body:n.json()}}).then(function(e){n.store.storeAvailableCount(e.body.available_count),n.store.storeStoppedCount(e.body.stopped_count),n.store.storeEnvironments(e.body.environments),n.store.setPagination(e.headers)}).then(function(){n.isLoading=!1}).catch(function(){n.isLoading=!1,new Flash("An error occurred while fetching the environments.","alert")})},methods:{toggleRow:function(n){return this.store.toggleFolder(n.name)},changePage:function(n){var e=gl.utils.setParamInURL("page",n);return gl.utils.visitUrl(e),e}},template:'\n    <div :class="cssContainerClass">\n      <div class="top-area">\n        <ul v-if="!isLoading" class="nav-links">\n          <li v-bind:class="{ \'active\': scope === null || scope === \'available\' }">\n            <a :href="projectEnvironmentsPath">\n              Available\n              <span class="badge js-available-environments-count">\n                {{state.availableCounter}}\n              </span>\n            </a>\n          </li>\n          <li v-bind:class="{ \'active\' : scope === \'stopped\' }">\n            <a :href="projectStoppedEnvironmentsPath">\n              Stopped\n              <span class="badge js-stopped-environments-count">\n                {{state.stoppedCounter}}\n              </span>\n            </a>\n          </li>\n        </ul>\n        <div v-if="canCreateEnvironmentParsed && !isLoading" class="nav-controls">\n          <a :href="newEnvironmentPath" class="btn btn-create">\n            New environment\n          </a>\n        </div>\n      </div>\n\n      <div class="content-list environments-container">\n        <div class="environments-list-loading text-center" v-if="isLoading">\n          <i class="fa fa-spinner fa-spin"></i>\n        </div>\n\n        <div class="blank-state blank-state-no-icon"\n          v-if="!isLoading && state.environments.length === 0">\n          <h2 class="blank-state-title js-blank-state-title">\n            You don\'t have any environments right now.\n          </h2>\n          <p class="blank-state-text">\n            Environments are places where code gets deployed, such as staging or production.\n            <br />\n            <a :href="helpPagePath">\n              Read more about environments\n            </a>\n          </p>\n\n          <a v-if="canCreateEnvironmentParsed"\n            :href="newEnvironmentPath"\n            class="btn btn-create js-new-environment-button">\n            New Environment\n          </a>\n        </div>\n\n        <div class="table-holder"\n          v-if="!isLoading && state.environments.length > 0">\n\n          <environment-table\n            :environments="state.environments"\n            :can-create-deployment="canCreateDeploymentParsed"\n            :can-read-environment="canReadEnvironmentParsed"/>\n        </div>\n\n        <table-pagination v-if="state.paginationInformation && state.paginationInformation.totalPages > 1"\n          :change="changePage"\n          :pageInfo="state.paginationInformation">\n        </table-pagination>\n      </div>\n    </div>\n  '})},"w+iT":function(n,e,t){function o(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var a=function(){function n(n,e){for(var t=0;t<e.length;t++){var o=e[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}}return function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}}();t("RsTm");var l=function(){function n(){return o(this,n),this.state={},this.state.environments=[],this.state.stoppedCounter=0,this.state.availableCounter=0,this.state.paginationInformation={},this}return a(n,[{key:"storeEnvironments",value:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=n.map(function(n){var e={};return n.size>1&&(e=Object.assign({},n,{isFolder:!0,folderName:n.name})),n.latest?(e=Object.assign(e,n,n.latest),delete e.latest):e=Object.assign(e,n),e});return this.state.environments=e,e}},{key:"setPagination",value:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=gl.utils.normalizeHeaders(n),t=gl.utils.parseIntPagination(e);return this.state.paginationInformation=t,t}},{key:"storeAvailableCount",value:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.state.availableCounter=n,n}},{key:"storeStoppedCount",value:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.state.stoppedCounter=n,n}}]),n}();n.exports=l}},["XJ/8"]);
//# sourceMappingURL=environments.5af11baa47dbbd6c3e67.bundle.js.map