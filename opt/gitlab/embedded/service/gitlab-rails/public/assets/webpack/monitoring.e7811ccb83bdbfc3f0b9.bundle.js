webpackJsonp([16,25,26],{IO1F:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("P//+");document.addEventListener("DOMContentLoaded",function t(){return document.removeEventListener("DOMContentLoaded",t,!1),new i.a},!1)},"P//+":function(t,e,a){"use strict";(function(t){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=a("+3IL"),n=a.n(r),s=a("P6M/"),o=a.n(s),l=a("RsTm"),h=(a.n(l),a("nYQN")),c=(a.n(h),function(){function t(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,a,i){return a&&t(e.prototype,a),i&&t(e,i),e}}()),m=".prometheus-graph",u="metrics.json",g=n.a.time.format("%H:%M"),p=n.a.time.format("%b %e, %a"),f=n.a.bisector(function(t){return t.time}).left,d=100,x=function(){function e(){i(this,e),this.margin={top:80,right:180,bottom:80,left:100},this.marginLabelContainer={top:40,right:0,bottom:40,left:0};var a=t(m).parent().width()+d;this.originalWidth=a,this.originalHeight=400,this.width=a-this.margin.left-this.margin.right,this.height=400-this.margin.top-this.margin.bottom,this.backOffRequestCounter=0,this.configureGraph(),this.init()}return c(e,[{key:"createGraph",value:function(){var t=this;Object.keys(this.data).forEach(function(e){var a=t.data[e];a.length>0&&t.plotValues(a,e)})}},{key:"init",value:function(){var t=this;this.getData().then(function(e){0===Object.keys(e).length?new Flash("Empty metrics","alert"):(t.transformData(e),t.createGraph())})}},{key:"plotValues",value:function(t,e){var a=n.a.time.scale().range([0,this.width]),i=n.a.scale.linear().range([this.height,0]),r=m+"[graph-type="+e+"]",s=this.graphSpecificProperties[e],o=n.a.select(r).attr("width",this.width+this.margin.left+this.margin.right).attr("height",this.height+this.margin.bottom+this.margin.top).append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),l=n.a.select(r).attr("width",this.originalWidth+this.marginLabelContainer.left+this.marginLabelContainer.right).attr("height",this.originalHeight+this.marginLabelContainer.bottom+this.marginLabelContainer.top).append("g").attr("transform","translate("+this.marginLabelContainer.left+","+this.marginLabelContainer.top+")");a.domain(n.a.extent(t,function(t){return t.time})),i.domain([0,n.a.max(t.map(function(t){return t.value}))]);var h=n.a.svg.axis().scale(a).ticks(this.commonGraphProperties.axis_no_ticks).orient("bottom"),c=n.a.svg.axis().scale(i).ticks(this.commonGraphProperties.axis_no_ticks).tickSize(-this.width).orient("left");this.createAxisLabelContainers(l,e),o.append("g").attr("class","x-axis").attr("transform","translate(0,"+this.height+")").call(h),o.append("g").attr("class","y-axis").call(c);var u=n.a.svg.area().x(function(t){return a(t.time)}).y0(this.height).y1(function(t){return i(t.value)}).interpolate("linear"),g=n.a.svg.line().x(function(t){return a(t.time)}).y(function(t){return i(t.value)});o.append("path").datum(t).attr("d",u).attr("class","metric-area").attr("fill",s.area_fill_color),o.append("path").datum(t).attr("class","metric-line").attr("stroke",s.line_color).attr("fill","none").attr("stroke-width",this.commonGraphProperties.area_stroke_width).attr("d",g),o.append("rect").attr("class","prometheus-graph-overlay").attr("width",this.width).attr("height",this.height).on("mousemove",this.handleMouseOverGraph.bind(this,a,i,t,o,r,e))}},{key:"createAxisLabelContainers",value:function(t,e){var a=this.graphSpecificProperties[e];t.append("line").attr("class","label-x-axis-line").attr("stroke","#000000").attr("stroke-width","1").attr({x1:0,y1:this.originalHeight-this.marginLabelContainer.top,x2:this.originalWidth-this.margin.right,y2:this.originalHeight-this.marginLabelContainer.top}),t.append("line").attr("class","label-y-axis-line").attr("stroke","#000000").attr("stroke-width","1").attr({x1:0,y1:0,x2:0,y2:this.originalHeight-this.marginLabelContainer.top}),t.append("text").attr("class","label-axis-text").attr("text-anchor","middle").attr("transform","translate(15, "+(this.originalHeight-this.marginLabelContainer.top)/2+") rotate(-90)").text(a.graph_legend_title),t.append("rect").attr("class","rect-axis-text").attr("x",this.originalWidth/2-this.margin.right).attr("y",this.originalHeight-this.marginLabelContainer.top-20).attr("width",30).attr("height",80),t.append("text").attr("class","label-axis-text").attr("x",this.originalWidth/2-this.margin.right).attr("y",this.originalHeight-this.marginLabelContainer.top).attr("dy",".35em").text("Time"),t.append("rect").attr("x",this.originalWidth-170).attr("y",this.originalHeight/2-60).style("fill",a.area_fill_color).attr("width",20).attr("height",35),t.append("text").attr("class","label-axis-text").attr("x",this.originalWidth-140).attr("y",this.originalHeight/2-50).text("Average"),t.append("text").attr("class","text-metric-usage").attr("x",this.originalWidth-140).attr("y",this.originalHeight/2-25)}},{key:"handleMouseOverGraph",value:function(t,e,a,i,r,s){var o=document.querySelector(r+" .prometheus-graph-overlay"),l=t.invert(n.a.mouse(o)[0]),h=f(a,l,1),c=a[h-1],m=a[h],u=l-c.time>m.time-l?m:c,d=e(n.a.max(a.map(function(t){return t.value}))),x=t(u.time),v=this.graphSpecificProperties[s];n.a.selectAll(r+" .selected-metric-line").remove(),n.a.selectAll(r+" .circle-metric").remove(),n.a.selectAll(r+" .rect-text-metric").remove(),n.a.selectAll(r+" .text-metric").remove(),i.append("line").attr("class","selected-metric-line").attr({x1:x,y1:e(0),x2:x,y2:d}),i.append("circle").attr("class","circle-metric").attr("fill",v.line_color).attr("cx",x).attr("cy",e(u.value)).attr("r",this.commonGraphProperties.circle_radius_metric);var _=i.append("g").attr("class","rect-text-metric").attr("translate","("+x+", "+e(u.value)+")");_.append("rect").attr("class","rect-metric").attr("x",x+10).attr("y",d).attr("width",this.commonGraphProperties.rect_text_width).attr("height",this.commonGraphProperties.rect_text_height),_.append("text").attr("class","text-metric").attr("x",x+35).attr("y",d+35).text(g(u.time)),_.append("text").attr("class","text-metric-date").attr("x",x+15).attr("y",d+15).text(p(u.time)),n.a.select(r+" .text-metric-usage").text(u.value.substring(0,8))}},{key:"configureGraph",value:function(){this.graphSpecificProperties={cpu_values:{area_fill_color:"#edf3fc",line_color:"#5b99f7",graph_legend_title:"CPU utilization (%)"},memory_values:{area_fill_color:"#fca326",line_color:"#fc6d26",graph_legend_title:"Memory usage (MB)"}},this.commonGraphProperties={area_stroke_width:2,median_total_characters:8,circle_radius_metric:5,rect_text_width:90,rect_text_height:40,axis_no_ticks:3}}},{key:"getData",value:function(){var e=this,a=3;return gl.utils.backOff(function(i,r){t.ajax({url:u,dataType:"json"}).done(function(t,n,s){s.status===o.a.NO_CONTENT?(e.backOffRequestCounter=e.backOffRequestCounter+=1,e.backOffRequestCounter<a?i():r({status:s.status,metrics:t})):r({status:s.status,metrics:t})}).fail(r)}).then(function(t){return t.status===o.a.NO_CONTENT?{}:t.metrics}).catch(function(){return new Flash("An error occurred while fetching metrics.","alert")})}},{key:"transformData",value:function(t){var e={};Object.keys(t.metrics).forEach(function(a){if("cpu_values"===a||"memory_values"===a){var i=t.metrics[a][0];e[a]=i.values.map(function(t){return{time:new Date(1e3*t[0]),value:t[1]}})}}),this.data=e}}]),e}();e.a=x}).call(e,a("lwLq"))},"P6M/":function(t,e){var a={NO_CONTENT:204,OK:200};t.exports=a}},["IO1F"]);
//# sourceMappingURL=monitoring.e7811ccb83bdbfc3f0b9.bundle.js.map