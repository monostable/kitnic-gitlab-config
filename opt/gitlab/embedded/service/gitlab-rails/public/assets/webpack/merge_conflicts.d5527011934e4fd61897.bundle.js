webpackJsonp([9,25,26],{"5AFF":function(e,t){!function(e){e.mergeConflicts=e.mergeConflicts||{},e.mergeConflicts.actions={methods:{handleSelected:function(e,t,i){gl.mergeConflicts.mergeConflictsStore.handleSelected(e,t,i)}}}}(window.gl||(window.gl={}))},"6wRZ":function(e,t){!function(e){e.mergeConflicts=e.mergeConflicts||{},e.mergeConflicts.inlineConflictLines=Vue.extend({props:{file:Object},mixins:[e.mergeConflicts.utils,e.mergeConflicts.actions]})}(window.gl||(window.gl={}))},"7+Qt":function(e,t,i){(function(e){function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();!function(n){n.mergeConflicts=n.mergeConflicts||{};var o=function(){function n(e){t(this,n),this.conflictsPath=e.conflictsPath,this.resolveConflictsPath=e.resolveConflictsPath}return i(n,[{key:"fetchConflictsData",value:function(){return e.ajax({dataType:"json",url:this.conflictsPath})}},{key:"submitResolveConflicts",value:function(t){return e.ajax({url:this.resolveConflictsPath,data:JSON.stringify(t),contentType:"application/json",dataType:"json",method:"POST"})}}]),n}();n.mergeConflicts.mergeConflictsService=o}(window.gl||(window.gl={}))}).call(t,i("lwLq"))},TbQ9:function(e,t,i){(function(e){function t(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}!function(i){i.mergeConflicts=i.mergeConflicts||{},i.mergeConflicts.diffFileEditor=Vue.extend({props:{file:Object,onCancelDiscardConfirmation:Function,onAcceptDiscardConfirmation:Function},data:function(){return{saved:!1,loading:!1,fileLoaded:!1,originalContent:""}},computed:{classObject:function(){return{saved:this.saved,"is-loading":this.loading}}},watch:t({},"file.showEditor",function(e){this.resetEditorContent(),!e||this.fileLoaded||this.loading||this.loadEditor()}),mounted:function(){this.file.loadEditor&&this.loadEditor()},methods:{loadEditor:function(){var t=this;this.loading=!0,e.get(this.file.content_path).done(function(e){var i=t.$el.querySelector("pre"),n=document.createTextNode(e.content);i.textContent=n.textContent,t.originalContent=e.content,t.fileLoaded=!0,t.editor=ace.edit(i),t.editor.$blockScrolling=1/0,t.editor.getSession().setMode("ace/mode/"+e.blob_ace_mode),t.editor.on("change",function(){t.saveDiffResolution()}),t.saveDiffResolution()}).fail(function(){new Flash("Failed to load the file, please try again.")}).always(function(){t.loading=!1})},saveDiffResolution:function(){this.saved=!0,this.file.content=this.editor.getValue(),this.file.resolveEditChanged=this.file.content!==this.originalContent,this.file.promptDiscardConfirmation=!1},resetEditorContent:function(){this.fileLoaded&&this.editor.setValue(this.originalContent,-1)},cancelDiscardConfirmation:function(e){this.onCancelDiscardConfirmation(e)},acceptDiscardConfirmation:function(e){this.onAcceptDiscardConfirmation(e)}}})}(window.gl||(window.gl={}))}).call(t,i("lwLq"))},WMxC:function(e,t,i){(function(e){!function(t){t.mergeConflicts=t.mergeConflicts||{};var i=Cookies.get("diff_view"),n="HEAD//our changes",o="origin//their changes",s="Use ours",l="Use theirs",a="interactive",c="edit",r=a,f={INLINE:"inline",PARALLEL:"parallel"},d={TEXT:"text",TEXT_EDITOR:"text-editor"};t.mergeConflicts.mergeConflictsStore={state:{isLoading:!0,hasError:!1,isSubmitting:!1,isParallel:i===f.PARALLEL,diffViewType:i,conflictsData:{}},setConflictsData:function(e){this.decorateFiles(e.files),this.state.conflictsData={files:e.files,commitMessage:e.commit_message,sourceBranch:e.source_branch,targetBranch:e.target_branch,shortCommitSha:e.commit_sha.slice(0,7)}},decorateFiles:function(e){var t=this;e.forEach(function(e){e.content="",e.resolutionData={},e.promptDiscardConfirmation=!1,e.resolveMode=r,e.filePath=t.getFilePath(e),e.iconClass="fa-"+e.blob_icon,e.blobPath=e.blob_path,e.type===d.TEXT?(e.showEditor=!1,e.loadEditor=!1,t.setInlineLine(e),t.setParallelLine(e)):e.type===d.TEXT_EDITOR&&(e.showEditor=!0,e.loadEditor=!0)})},setInlineLine:function(e){var t=this;e.inlineLines=[],e.sections.forEach(function(i){var n="new",o=i.conflict,s=i.lines,l=i.id;o&&e.inlineLines.push(t.getHeadHeaderLine(l)),s.forEach(function(i){var s=i.type;"new"!==s&&"old"!==s||n===s||(n=s,e.inlineLines.push({lineType:"emptyLine",richText:""})),t.decorateLineForInlineView(i,l,o),e.inlineLines.push(i)}),o&&e.inlineLines.push(t.getOriginHeaderLine(l))})},setParallelLine:function(e){var t=this;e.parallelLines=[];var i={left:[],right:[]};e.sections.forEach(function(e){var n=e.conflict,o=e.lines,s=e.id;n&&(i.left.push(t.getOriginHeaderLine(s)),i.right.push(t.getHeadHeaderLine(s))),o.forEach(function(e){var o=e.type;if(n)"old"===o?i.left.push(t.getLineForParallelView(e,s,"conflict")):"new"===o&&i.right.push(t.getLineForParallelView(e,s,"conflict",!0));else{var l=o||"context";i.left.push(t.getLineForParallelView(e,s,l)),i.right.push(t.getLineForParallelView(e,s,l,!0))}}),t.checkLineLengths(i)});for(var n=0,o=i.left.length;n<o;n+=1)e.parallelLines.push([i.right[n],i.left[n]])},setLoadingState:function(e){this.state.isLoading=e},setErrorState:function(e){this.state.hasError=e},setFailedRequest:function(e){this.state.hasError=!0,this.state.conflictsData.errorMessage=e},getConflictsCount:function(){if(!this.state.conflictsData.files.length)return 0;var e=this.state.conflictsData.files,t=0;return e.forEach(function(e){e.type===d.TEXT?e.sections.forEach(function(e){e.conflict&&(t+=1)}):t+=1}),t},getConflictsCountText:function(){var e=this.getConflictsCount(),t=e?"conflicts":"conflict";return e+" "+t},setViewType:function(e){this.state.diffView=e,this.state.isParallel=e===f.PARALLEL,Cookies.set("diff_view",e)},getHeadHeaderLine:function(e){return{id:e,richText:n,buttonTitle:s,type:"new",section:"head",isHeader:!0,isHead:!0,isSelected:!1,isUnselected:!1}},decorateLineForInlineView:function(e,t,i){var n=e.type;e.id=t,e.hasConflict=i,e.isHead="new"===n,e.isOrigin="old"===n,e.hasMatch="match"===n,e.richText=e.rich_text,e.isSelected=!1,e.isUnselected=!1},getLineForParallelView:function(e,t,i,n){var o=e.old_line,s=e.new_line,l=e.rich_text,a="conflict"===i;return{id:t,lineType:i,hasConflict:a,isHead:a&&n,isOrigin:a&&!n,hasMatch:"match"===i,lineNumber:n?s:o,section:n?"head":"origin",richText:l,isSelected:!1,isUnselected:!1}},getOriginHeaderLine:function(e){return{id:e,richText:o,buttonTitle:l,type:"old",section:"origin",isHeader:!0,isOrigin:!0,isSelected:!1,isUnselected:!1}},getFilePath:function(e){var t=e.old_path,i=e.new_path;return t===i?i:t+" â†’ "+i},checkLineLengths:function(e){var t=e.left,i=e.right;if(t.length!==i.length)if(t.length>i.length)for(var n=t.length-i.length,o=0;o<n;o+=1)i.push({lineType:"emptyLine",richText:""});else for(var s=i.length-t.length,l=0;l<s;l+=1)t.push({lineType:"emptyLine",richText:""})},setPromptConfirmationState:function(e,t){e.promptDiscardConfirmation=t},setFileResolveMode:function(e,t){t===a?e.showEditor=!1:t===c&&(e.showEditor=!0,e.loadEditor=!0,e.resolutionData={},this.restoreFileLinesState(e)),e.resolveMode=t},restoreFileLinesState:function(e){e.inlineLines.forEach(function(e){(e.hasConflict||e.isHeader)&&(e.isSelected=!1,e.isUnselected=!1)}),e.parallelLines.forEach(function(e){var t=e[0],i=e[1],n=t.hasConflict||t.isHeader,o=i.hasConflict||i.isHeader;(n||o)&&(t.isSelected=!1,t.isUnselected=!1,i.isSelected=!1,i.isUnselected=!1)})},isReadyToCommit:function(){for(var t=this.state.conflictsData.files,i=e.trim(this.state.conflictsData.commitMessage).length,n=0,o=0,s=t.length;o<s;o+=1){var l=t[o];if(l.resolveMode===a){var r=0,f=Object.keys(l.resolutionData).length;if(l.type===d.TEXT){for(var u=0,h=l.sections.length;u<h;u+=1)l.sections[u].conflict&&(r+=1);f!==r&&(n+=1)}}else if(l.resolveMode===c&&!l.content){n+=1;continue}}return!this.state.isSubmitting&&i&&!n},getCommitButtonText:function(){var e="Commit conflict resolution",t="Committing...";return this.state&&this.state.isSubmitting?t:e},getCommitData:function(){var e={};return e={commit_message:this.state.conflictsData.commitMessage,files:[]},this.state.conflictsData.files.forEach(function(t){var i={old_path:t.old_path,new_path:t.new_path};t.type===d.TEXT?t.resolveMode===a?i.sections=t.resolutionData:t.resolveMode===c&&(i.content=t.content):t.type===d.TEXT_EDITOR&&(i.content=t.content),e.files.push(i)}),e},handleSelected:function(e,t,i){var n=this;Vue.set(e.resolutionData,t,i),e.inlineLines.forEach(function(e){e.id===t&&(e.hasConflict||e.isHeader)&&n.markLine(e,i)}),e.parallelLines.forEach(function(e){var o=e[0],s=e[1],l=s.id===t||o.id===t,a=o.hasConflict||o.isHeader,c=s.hasConflict||s.isHeader;l&&(a||c)&&(n.markLine(o,i),n.markLine(s,i))})},markLine:function(e,t){"head"===t&&e.isHead?(e.isSelected=!0,e.isUnselected=!1):"origin"===t&&e.isOrigin?(e.isSelected=!0,e.isUnselected=!1):(e.isSelected=!1,e.isUnselected=!0)},setSubmitState:function(e){this.state.isSubmitting=e},fileTextTypePresent:function(){return this.state.conflictsData.files.some(function(e){return e.type===d.TEXT})}}}(window.gl||(window.gl={}))}).call(t,i("lwLq"))},dIvF:function(e,t,i){(function(e){window.Vue=i("Eruj"),i("WMxC"),i("7+Qt"),i("zALn"),i("5AFF"),i("TbQ9"),i("6wRZ"),i("yEia"),e(function(){var t="interactive",i=document.querySelector("#conflicts"),n=gl.mergeConflicts.mergeConflictsStore,o=new gl.mergeConflicts.mergeConflictsService({conflictsPath:i.dataset.conflictsPath,resolveConflictsPath:i.dataset.resolveConflictsPath});gl.MergeConflictsResolverApp=new Vue({el:"#conflicts",data:n.state,components:{"diff-file-editor":gl.mergeConflicts.diffFileEditor,"inline-conflict-lines":gl.mergeConflicts.inlineConflictLines,"parallel-conflict-lines":gl.mergeConflicts.parallelConflictLines},computed:{conflictsCountText:function(){return n.getConflictsCountText()},readyToCommit:function(){return n.isReadyToCommit()},commitButtonText:function(){return n.getCommitButtonText()},showDiffViewTypeSwitcher:function(){return n.fileTextTypePresent()}},created:function(){var t=this;o.fetchConflictsData().done(function(e){"error"===e.type?n.setFailedRequest(e.message):n.setConflictsData(e)}).error(function(){n.setFailedRequest()}).always(function(){n.setLoadingState(!1),t.$nextTick(function(){e(".js-syntax-highlight").syntaxHighlight()})})},methods:{handleViewTypeChange:function(e){n.setViewType(e)},onClickResolveModeButton:function(e,i){return i===t&&e.resolveEditChanged?void n.setPromptConfirmationState(e,!0):void n.setFileResolveMode(e,i)},acceptDiscardConfirmation:function(e){n.setPromptConfirmationState(e,!1),n.setFileResolveMode(e,t)},cancelDiscardConfirmation:function(e){n.setPromptConfirmationState(e,!1)},commit:function(){n.setSubmitState(!0),o.submitResolveConflicts(n.getCommitData()).done(function(e){window.location.href=e.redirect_to}).error(function(){n.setSubmitState(!1),new Flash("Failed to save merge conflicts resolutions. Please try again!")})}}})})}).call(t,i("lwLq"))},yEia:function(e,t){!function(e){e.mergeConflicts=e.mergeConflicts||{},e.mergeConflicts.parallelConflictLines=Vue.extend({props:{file:Object},mixins:[e.mergeConflicts.utils,e.mergeConflicts.actions],template:'\n      <table>\n        <tr class="line_holder parallel" v-for="section in file.parallelLines">\n          <template v-for="line in section">\n            <td class="diff-line-num header" :class="lineCssClass(line)" v-if="line.isHeader"></td>\n            <td class="line_content header" :class="lineCssClass(line)" v-if="line.isHeader">\n              <strong>{{line.richText}}</strong>\n              <button class="btn" @click="handleSelected(file, line.id, line.section)">{{line.buttonTitle}}</button>\n            </td>\n            <td class="diff-line-num old_line" :class="lineCssClass(line)" v-if="!line.isHeader">{{line.lineNumber}}</td>\n            <td class="line_content parallel" :class="lineCssClass(line)" v-if="!line.isHeader" v-html="line.richText"></td>\n          </template>\n        </tr>\n      </table>\n    '})}(window.gl||(window.gl={}))},zALn:function(e,t){!function(e){e.mergeConflicts=e.mergeConflicts||{},e.mergeConflicts.utils={methods:{lineCssClass:function(e){return{head:e.isHead,origin:e.isOrigin,match:e.hasMatch,selected:e.isSelected,unselected:e.isUnselected}}}}}(window.gl||(window.gl={}))}},["dIvF"]);
//# sourceMappingURL=merge_conflicts.d5527011934e4fd61897.bundle.js.map