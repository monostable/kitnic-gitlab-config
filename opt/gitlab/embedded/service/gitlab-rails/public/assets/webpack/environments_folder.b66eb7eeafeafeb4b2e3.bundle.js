webpackJsonp([5,25,26],{"3qMg":function(e,n,t){var o=t("Eruj"),a=t("j4Jp");t("A+3H"),t("zp3R");var l=t("R8Dz"),i=t("AhTQ"),s=t("kXVd"),r=t("FaWK"),m=t("Q/iC"),d=new a;e.exports=o.component("environment-item",{components:{"commit-component":gl.CommitComponent,"actions-component":l,"external-url-component":i,"stop-component":s,"rollback-component":r,"terminal-button-component":m},props:{model:{type:Object,required:!0,default:function(){return{}}},canCreateDeployment:{type:Boolean,required:!1,default:!1},canReadEnvironment:{type:Boolean,required:!1,default:!1}},computed:{hasLastDeploymentKey:function(){return!(!this.model||!this.model.last_deployment||this.$options.isObjectEmpty(this.model.last_deployment))},hasManualActions:function(){return this.model&&this.model.last_deployment&&this.model.last_deployment.manual_actions&&this.model.last_deployment.manual_actions.length>0},hasStopAction:function(){return this.model&&this.model["stop_action?"]},canRetry:function(){return this.model&&this.hasLastDeploymentKey&&this.model.last_deployment&&this.model.last_deployment.deployable},canShowDate:function(){return this.model&&this.model.last_deployment&&this.model.last_deployment.deployable&&void 0!==this.model.last_deployment.deployable},createdDate:function(){return this.model&&this.model.last_deployment&&this.model.last_deployment.deployable&&this.model.last_deployment.deployable.created_at?d.format(this.model.last_deployment.deployable.created_at):""},manualActions:function(){return this.hasManualActions?this.model.last_deployment.manual_actions.map(function(e){var n={name:gl.text.humanize(e.name),play_path:e.play_path};return n}):[]},userImageAltDescription:function(){return this.model&&this.model.last_deployment&&this.model.last_deployment.user&&this.model.last_deployment.user.username?this.model.last_deployment.user.username+"'s avatar'":""},commitTag:function(){if(this.model&&this.model.last_deployment&&this.model.last_deployment.tag)return this.model.last_deployment.tag},commitRef:function(){if(this.model&&this.model.last_deployment&&this.model.last_deployment.ref)return this.model.last_deployment.ref},commitUrl:function(){if(this.model&&this.model.last_deployment&&this.model.last_deployment.commit&&this.model.last_deployment.commit.commit_path)return this.model.last_deployment.commit.commit_path},commitShortSha:function(){if(this.model&&this.model.last_deployment&&this.model.last_deployment.commit&&this.model.last_deployment.commit.short_id)return this.model.last_deployment.commit.short_id},commitTitle:function(){if(this.model&&this.model.last_deployment&&this.model.last_deployment.commit&&this.model.last_deployment.commit.title)return this.model.last_deployment.commit.title},commitAuthor:function(){if(this.model&&this.model.last_deployment&&this.model.last_deployment.commit&&this.model.last_deployment.commit.author)return this.model.last_deployment.commit.author},retryUrl:function(){if(this.model&&this.model.last_deployment&&this.model.last_deployment.deployable&&this.model.last_deployment.deployable.retry_path)return this.model.last_deployment.deployable.retry_path},isLastDeployment:function(){return this.model&&this.model.last_deployment&&this.model.last_deployment["last?"]},buildName:function(){return this.model&&this.model.last_deployment&&this.model.last_deployment.deployable?this.model.last_deployment.deployable.name+" #"+this.model.last_deployment.deployable.id:""},deploymentInternalId:function(){return this.model&&this.model.last_deployment&&this.model.last_deployment.iid?"#"+this.model.last_deployment.iid:""},deploymentHasUser:function(){return this.model&&!this.$options.isObjectEmpty(this.model.last_deployment)&&!this.$options.isObjectEmpty(this.model.last_deployment.user)},deploymentUser:function(){return!this.model||this.$options.isObjectEmpty(this.model.last_deployment)||this.$options.isObjectEmpty(this.model.last_deployment.user)?{}:this.model.last_deployment.user},shouldRenderBuildName:function(){return!this.model.isFolder&&!this.$options.isObjectEmpty(this.model.last_deployment)&&!this.$options.isObjectEmpty(this.model.last_deployment.deployable)},buildPath:function(){return this.model&&this.model.last_deployment&&this.model.last_deployment.deployable&&this.model.last_deployment.deployable.build_path?this.model.last_deployment.deployable.build_path:""},externalURL:function(){return this.model&&this.model.external_url?this.model.external_url:""},shouldRenderDeploymentID:function(){return!this.model.isFolder&&!this.$options.isObjectEmpty(this.model.last_deployment)&&void 0!==this.model.last_deployment.iid},environmentPath:function(){return this.model&&this.model.environment_path?this.model.environment_path:""},folderUrl:function(){return window.location.pathname+"/folders/"+this.model.folderName}},isObjectEmpty:function(e){for(var n in e)if(hasOwnProperty.call(e,n))return!1;return!0},template:'\n    <tr>\n      <td>\n        <a v-if="!model.isFolder"\n          class="environment-name"\n          :href="environmentPath">\n          {{model.name}}\n        </a>\n        <a v-else class="folder-name" :href="folderUrl">\n          <span class="folder-icon">\n            <i class="fa fa-folder" aria-hidden="true"></i>\n          </span>\n\n          <span>\n            {{model.folderName}}\n          </span>\n\n          <span class="badge">\n            {{model.size}}\n          </span>\n        </a>\n      </td>\n\n      <td class="deployment-column">\n        <span v-if="shouldRenderDeploymentID">\n          {{deploymentInternalId}}\n        </span>\n\n        <span v-if="!model.isFolder && deploymentHasUser">\n          by\n          <a :href="deploymentUser.web_url" class="js-deploy-user-container">\n            <img class="avatar has-tooltip s20"\n              :src="deploymentUser.avatar_url"\n              :alt="userImageAltDescription"\n              :title="deploymentUser.username" />\n          </a>\n        </span>\n      </td>\n\n      <td class="environments-build-cell">\n        <a v-if="shouldRenderBuildName"\n          class="build-link"\n          :href="buildPath">\n          {{buildName}}\n        </a>\n      </td>\n\n      <td>\n        <div v-if="!model.isFolder && hasLastDeploymentKey" class="js-commit-component">\n          <commit-component\n            :tag="commitTag"\n            :commit-ref="commitRef"\n            :commit-url="commitUrl"\n            :short-sha="commitShortSha"\n            :title="commitTitle"\n            :author="commitAuthor"/>\n        </div>\n        <p v-if="!model.isFolder && !hasLastDeploymentKey" class="commit-title">\n          No deployments yet\n        </p>\n      </td>\n\n      <td>\n        <span v-if="!model.isFolder && canShowDate"\n          class="environment-created-date-timeago">\n          {{createdDate}}\n        </span>\n      </td>\n\n      <td class="environments-actions">\n        <div v-if="!model.isFolder" class="btn-group pull-right" role="group">\n          <actions-component v-if="hasManualActions && canCreateDeployment"\n            :actions="manualActions"/>\n\n          <external-url-component v-if="externalURL && canReadEnvironment"\n            :external-url="externalURL"/>\n\n          <stop-component v-if="hasStopAction && canCreateDeployment"\n            :stop-url="model.stop_path"/>\n\n          <terminal-button-component v-if="model && model.terminal_path"\n            :terminal-path="model.terminal_path"/>\n\n          <rollback-component v-if="canRetry && canCreateDeployment"\n            :is-last-deployment="isLastDeployment"\n            :retry-url="retryUrl"/>\n        </div>\n      </td>\n    </tr>\n  '})},AhTQ:function(e,n,t){var o=t("Eruj");e.exports=o.component("external-url-component",{props:{externalUrl:{type:String,default:""}},template:'\n    <a class="btn external_url" :href="externalUrl" target="_blank" rel="noopener noreferrer">\n      <i class="fa fa-external-link"></i>\n    </a>\n  '})},FaWK:function(e,n,t){var o=t("Eruj");e.exports=o.component("rollback-component",{props:{retryUrl:{type:String,default:""},isLastDeployment:{type:Boolean,default:!0}},template:'\n    <a class="btn" :href="retryUrl" data-method="post" rel="nofollow">\n      <span v-if="isLastDeployment">\n        Re-deploy\n      </span>\n      <span v-else>\n        Rollback\n      </span>\n    </a>\n  '})},Knvv:function(e,n,t){(function(e){var n=t("WZt5");e(function(){window.gl=window.gl||{},gl.EnvironmentsListFolderApp&&gl.EnvironmentsListFolderApp.$destroy(!0),gl.EnvironmentsListFolderApp=new n({el:document.querySelector("#environments-folder-list-view")})})}).call(n,t("lwLq"))},"Q/iC":function(e,n,t){var o=t("Eruj"),a=t("WEra");e.exports=o.component("terminal-button-component",{props:{terminalPath:{type:String,default:""}},data:function(){return{terminalIconSvg:a}},template:'\n    <a class="btn terminal-button"\n      :href="terminalPath">\n      '+a+"\n    </a>\n  "})},R8Dz:function(e,n,t){var o=t("Eruj"),a=t("LIwm");e.exports=o.component("actions-component",{props:{actions:{type:Array,required:!1,default:function(){return[]}}},data:function(){return{playIconSvg:a}},template:'\n    <div class="btn-group" role="group">\n      <button class="dropdown btn btn-default dropdown-new" data-toggle="dropdown">\n        <span>\n          <span class="js-dropdown-play-icon-container" v-html="playIconSvg"></span>\n          <i class="fa fa-caret-down"></i>\n        </span>\n\n      <ul class="dropdown-menu dropdown-menu-align-right">\n        <li v-for="action in actions">\n          <a :href="action.play_path"\n            data-method="post"\n            rel="nofollow"\n            class="js-manual-action-link">\n            '+a+"\n            <span>\n              {{action.name}}\n            </span>\n          </a>\n        </li>\n      </ul>\n    </button>\n  </div>\n  "})},WEra:function(e,n){e.exports='<svg width="19" height="14" viewBox="0 0 19 14" xmlns="http://www.w3.org/2000/svg"><rect fill="#848484" x="7.2" y="9.25" width="6.46" height="1.5" rx=".5"/><path d="M5.851 7.016L3.81 9.103a.503.503 0 0 0 .017.709l.35.334c.207.198.524.191.717-.006l2.687-2.748a.493.493 0 0 0 .137-.376.493.493 0 0 0-.137-.376L4.894 3.892a.507.507 0 0 0-.717-.006l-.35.334a.503.503 0 0 0-.017.709L5.85 7.016z"/><path d="M1.25 11.497c0 .691.562 1.253 1.253 1.253h13.994c.694 0 1.253-.56 1.253-1.253V2.503c0-.691-.562-1.253-1.253-1.253H2.503c-.694 0-1.253.56-1.253 1.253v8.994zM2.503 0h13.994A2.504 2.504 0 0 1 19 2.503v8.994A2.501 2.501 0 0 1 16.497 14H2.503A2.504 2.504 0 0 1 0 11.497V2.503A2.501 2.501 0 0 1 2.503 0z"/></svg>\n'},WZt5:function(e,n,t){var o=window.Vue=t("Eruj");window.Vue.use(t("7UJR"));var a=t("pGP2"),l=t("jNb8"),i=t("w+iT");t("03o2"),t("RsTm"),t("wFzz"),e.exports=o.component("environment-folder-view",{components:{"environment-table":l,"table-pagination":gl.VueGlPagination},data:function(){var e=document.querySelector("#environments-folder-list-view").dataset,n=new i,t=window.location.pathname,o=t+".json",a=t.substr(t.lastIndexOf("/")+1);return{store:n,folderName:a,endpoint:o,state:n.state,visibility:"available",isLoading:!1,cssContainerClass:e.cssClass,canCreateDeployment:e.canCreateDeployment,canReadEnvironment:e.canReadEnvironment,commitIconSvg:e.commitIconSvg,playIconSvg:e.playIconSvg,terminalIconSvg:e.terminalIconSvg,paginationInformation:{},pageNumber:1}},computed:{scope:function(){return gl.utils.getParameterByName("scope")},canReadEnvironmentParsed:function(){return gl.utils.convertPermissionToBoolean(this.canReadEnvironment)},canCreateDeploymentParsed:function(){return gl.utils.convertPermissionToBoolean(this.canCreateDeployment)},stoppedPath:function(){return window.location.pathname+"?scope=stopped"},availablePath:function(){return window.location.pathname}},created:function(){var e=this,n=gl.utils.getParameterByName("scope")||this.visibility,t=gl.utils.getParameterByName("page")||this.pageNumber,o=this.endpoint+"?scope="+n+"&page="+t,l=new a(o);return this.isLoading=!0,l.get().then(function(e){return{headers:e.headers,body:e.json()}}).then(function(n){e.store.storeAvailableCount(n.body.available_count),e.store.storeStoppedCount(n.body.stopped_count),e.store.storeEnvironments(n.body.environments),e.store.setPagination(n.headers)}).then(function(){e.isLoading=!1}).catch(function(){e.isLoading=!1,new Flash("An error occurred while fetching the environments.","alert")})},methods:{changePage:function(e){var n=gl.utils.setParamInURL("page",e);return gl.utils.visitUrl(n),n}},template:'\n    <div :class="cssContainerClass">\n      <div class="top-area" v-if="!isLoading">\n\n        <h4 class="js-folder-name environments-folder-name">\n          Environments / <b>{{folderName}}</b>\n        </h4>\n\n        <ul class="nav-links">\n          <li v-bind:class="{ \'active\': scope === null || scope === \'available\' }">\n            <a :href="availablePath" class="js-available-environments-folder-tab">\n              Available\n              <span class="badge js-available-environments-count">\n                {{state.availableCounter}}\n              </span>\n            </a>\n          </li>\n          <li v-bind:class="{ \'active\' : scope === \'stopped\' }">\n            <a :href="stoppedPath" class="js-stopped-environments-folder-tab">\n              Stopped\n              <span class="badge js-stopped-environments-count">\n                {{state.stoppedCounter}}\n              </span>\n            </a>\n          </li>\n        </ul>\n      </div>\n\n      <div class="environments-container">\n        <div class="environments-list-loading text-center" v-if="isLoading">\n          <i class="fa fa-spinner fa-spin"></i>\n        </div>\n\n        <div class="table-holder"\n          v-if="!isLoading && state.environments.length > 0">\n\n          <environment-table\n            :environments="state.environments"\n            :can-create-deployment="canCreateDeploymentParsed"\n            :can-read-environment="canReadEnvironmentParsed"\n            :play-icon-svg="playIconSvg"\n            :terminal-icon-svg="terminalIconSvg"\n            :commit-icon-svg="commitIconSvg">\n          </environment-table>\n\n          <table-pagination v-if="state.paginationInformation && state.paginationInformation.totalPages > 1"\n            :change="changePage"\n            :pageInfo="state.paginationInformation">\n          </table-pagination>\n        </div>\n      </div>\n    </div>\n  '})},jNb8:function(e,n,t){var o=t("Eruj"),a=t("3qMg");e.exports=o.component("environment-table-component",{components:{"environment-item":a},props:{environments:{type:Array,required:!0,default:function(){return[]}},canReadEnvironment:{type:Boolean,required:!1,default:!1},canCreateDeployment:{type:Boolean,required:!1,default:!1}},template:'\n    <table class="table ci-table">\n      <thead>\n        <tr>\n          <th class="environments-name">Environment</th>\n          <th class="environments-deploy">Last deployment</th>\n          <th class="environments-build">Job</th>\n          <th class="environments-commit">Commit</th>\n          <th class="environments-date">Updated</th>\n          <th class="environments-actions"></th>\n        </tr>\n      </thead>\n      <tbody>\n        <template v-for="model in environments"\n          v-bind:model="model">\n          <tr is="environment-item"\n            :model="model"\n            :can-create-deployment="canCreateDeployment"\n            :can-read-environment="canReadEnvironment"></tr>\n        </template>\n      </tbody>\n    </table>\n  '})},kXVd:function(e,n,t){var o=t("Eruj");e.exports=o.component("stop-component",{props:{stopUrl:{type:String,default:""}},template:'\n    <a class="btn stop-env-link"\n      :href="stopUrl"\n      data-confirm="Are you sure you want to stop this environment?"\n      data-method="post"\n      rel="nofollow">\n      <i class="fa fa-stop stop-env-icon" aria-hidden="true"></i>\n    </a>\n  '})},pGP2:function(e,n,t){function o(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),l=t("Eruj"),i=function(){function e(n){o(this,e),this.environments=l.resource(n)}return a(e,[{key:"get",value:function(){return this.environments.get()}}]),e}();e.exports=i},"w+iT":function(e,n,t){function o(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();t("RsTm");var l=function(){function e(){return o(this,e),this.state={},this.state.environments=[],this.state.stoppedCounter=0,this.state.availableCounter=0,this.state.paginationInformation={},this}return a(e,[{key:"storeEnvironments",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=e.map(function(e){var n={};return e.size>1&&(n=Object.assign({},e,{isFolder:!0,folderName:e.name})),e.latest?(n=Object.assign(n,e,e.latest),delete n.latest):n=Object.assign(n,e),n});return this.state.environments=n,n}},{key:"setPagination",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=gl.utils.normalizeHeaders(e),t=gl.utils.parseIntPagination(n);return this.state.paginationInformation=t,t}},{key:"storeAvailableCount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.state.availableCounter=e,e}},{key:"storeStoppedCount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.state.stoppedCounter=e,e}}]),e}();e.exports=l}},["Knvv"]);
//# sourceMappingURL=environments_folder.b66eb7eeafeafeb4b2e3.bundle.js.map