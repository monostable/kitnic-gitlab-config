webpackJsonp([7,25,26],{"6Dwg":function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(r)};n("noYj"),function(){var e=function(e){function t(e,n,o,a,l,s){r(this,t);var u=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,o,a));return u.symbol=s,u.config={droplabAjax:{endpoint:l,method:"setData",loadingTemplate:u.loadingTemplate},droplabFilter:{filterFunction:gl.DropdownUtils.filterWithSymbol.bind(null,u.symbol,o)}},u}return o(t,e),a(t,[{key:"itemClicked",value:function(e){var n=this;l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"itemClicked",this).call(this,e,function(e){var t=e.querySelector(".js-data-value").innerText.trim();return""+n.symbol+gl.DropdownUtils.getEscapedText(t)})}},{key:"renderContent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.droplab.changeHookList(this.hookId,this.dropdown,[droplabAjax,droplabFilter],this.config),l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"renderContent",this).call(this,e)}},{key:"init",value:function(){this.droplab.addHook(this.input,this.dropdown,[droplabAjax,droplabFilter],this.config).init()}}]),t}(gl.FilteredSearchDropdown);window.gl=window.gl||{},gl.DropdownNonUser=e}()},"G85/":function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(){n(this,e)}return r(e,null,[{key:"getLastVisualTokenBeforeInput",value:function(){var e=document.querySelector(".input-token"),t=e&&e.previousElementSibling;return{lastVisualToken:t,isLastVisualTokenValid:null===t||t.className.indexOf("filtered-search-term")!==-1||t&&null!==t.querySelector(".value")}}},{key:"unselectTokens",value:function(){var e=document.querySelectorAll(".js-visual-token .selectable.selected");[].forEach.call(e,function(e){return e.classList.remove("selected")})}},{key:"selectToken",value:function(t){var n=t.classList.contains("selected");e.unselectTokens(),n||t.classList.add("selected")}},{key:"removeSelectedToken",value:function(){var e=document.querySelector(".js-visual-token .selected");if(e){var t=e.closest(".js-visual-token");t.parentElement.removeChild(t)}}},{key:"createVisualTokenElementHTML",value:function(){return'\n      <div class="selectable" role="button">\n        <div class="name"></div>\n        <div class="value"></div>\n      </div>\n    '}},{key:"addVisualTokenElement",value:function(t,n,r){var i=document.createElement("li");i.classList.add("js-visual-token"),i.classList.add(r?"filtered-search-term":"filtered-search-token"),n?(i.innerHTML=e.createVisualTokenElementHTML(),i.querySelector(".value").innerText=n):i.innerHTML='<div class="name"></div>',i.querySelector(".name").innerText=t;var o=document.querySelector(".tokens-container"),a=document.querySelector(".filtered-search");o.insertBefore(i,a.parentElement)}},{key:"addValueToPreviousVisualTokenElement",value:function(t){var n=e.getLastVisualTokenBeforeInput(),r=n.lastVisualToken,i=n.isLastVisualTokenValid;if(!i&&r.classList.contains("filtered-search-token")){var o=e.getLastTokenPartial();r.innerHTML=e.createVisualTokenElementHTML(),r.querySelector(".name").innerText=o,r.querySelector(".value").innerText=t}}},{key:"addFilterVisualToken",value:function(t,n){var r=e.getLastVisualTokenBeforeInput(),i=r.lastVisualToken,o=r.isLastVisualTokenValid,a=e.addVisualTokenElement;if(o)a(t,n);else{var l=i.querySelector(".name").innerText,s=document.querySelector(".tokens-container");s.removeChild(i);var u=n||t;a(l,u)}}},{key:"addSearchVisualToken",value:function(t){var n=e.getLastVisualTokenBeforeInput(),r=n.lastVisualToken;r&&r.classList.contains("filtered-search-term")?r.querySelector(".name").innerText+=" "+t:e.addVisualTokenElement(t,null,!0)}},{key:"getLastTokenPartial",value:function(){var t=e.getLastVisualTokenBeforeInput(),n=t.lastVisualToken;if(!n)return"";var r=n.querySelector(".value"),i=n.querySelector(".name"),o=r?r.innerText:"",a=i?i.innerText:"";return o||a}},{key:"removeLastTokenPartial",value:function(){var t=e.getLastVisualTokenBeforeInput(),n=t.lastVisualToken;if(n){var r=n.querySelector(".value");if(r){var i=n.querySelector(".selectable");i.removeChild(r),n.innerHTML=i.innerHTML}else n.closest(".tokens-container").removeChild(n)}}},{key:"tokenizeInput",value:function(){var t=document.querySelector(".filtered-search"),n=gl.FilteredSearchVisualTokens.getLastVisualTokenBeforeInput(),r=n.isLastVisualTokenValid;t.value&&(r?gl.FilteredSearchVisualTokens.addSearchVisualToken(t.value):e.addValueToPreviousVisualTokenElement(t.value),t.value="")}},{key:"editToken",value:function(t){var n=document.querySelector(".filtered-search");e.tokenizeInput();var r=t.parentElement,i=n.parentElement;r.replaceChild(i,t);var o=t.querySelector(".name"),a=t.querySelector(".value");t.classList.contains("filtered-search-token")&&a?(e.addFilterVisualToken(o.innerText),n.value=a.innerText):n.value=o.innerText;var l=new Event("input");n.dispatchEvent(l),n.focus()}},{key:"moveInputToTheRight",value:function(){var t=document.querySelector(".filtered-search"),n=t.parentElement,r=document.querySelector(".tokens-container");if(e.tokenizeInput(),!r.lastElementChild.isEqualNode(n)){var i=gl.FilteredSearchVisualTokens.getLastVisualTokenBeforeInput(),o=i.isLastVisualTokenValid;if(!o){var a=gl.FilteredSearchVisualTokens.getLastTokenPartial();gl.FilteredSearchVisualTokens.removeLastTokenPartial(),gl.FilteredSearchVisualTokens.addSearchVisualToken(a)}r.removeChild(n),r.appendChild(n)}}}]),e}();window.gl=window.gl||{},gl.FilteredSearchVisualTokens=i},LrW2:function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n("zrWn"),function(){var e=function(){function e(){r(this,e)}return i(e,null,[{key:"processTokens",value:function(e){var t=gl.FilteredSearchTokenKeys.get().map(function(e){return e.key}),n=new RegExp("("+t.join("|")+"):([~%@]?)(?:('[^']*'{0,1})|(\"[^\"]*\"{0,1})|(\\S+))","g"),r=[],i=null,o=e.replace(n,function(e,t,n,i,o,a){var l=i||o||a,s=n;return"~"!==l&&"%"!==l&&"@"!==l||(s=l,l=""),r.push({key:t,value:l||"",symbol:s||""}),""}).replace(/\s{2,}/g," ").trim()||"";if(r.length>0){var a=r[r.length-1],l=a.key+":"+a.symbol+a.value;i=e.lastIndexOf(l)===e.length-l.length?a:o}else i=o;return{tokens:r,lastToken:i,searchToken:o}}}]),e}();window.gl=window.gl||{},gl.FilteredSearchTokenizer=e}()},MxQn:function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n("noYj"),function(){var e=function(e){function t(e,n,o,a){r(this,t);var l=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,o,a));return l.config={droplabFilter:{template:"hint",filterFunction:gl.DropdownUtils.filterHint.bind(null,o)}},l}return o(t,e),a(t,[{key:"itemClicked",value:function(e){var t=e.detail.selected;if("LI"===t.tagName)if(t.hasAttribute("data-value"))this.dismissDropdown();else if("submit"===t.getAttribute("data-action"))this.dismissDropdown(),this.dispatchFormSubmitEvent();else{var n=t.querySelector(".js-filter-hint").innerText.trim(),r=t.querySelector(".js-filter-tag").innerText.trim();if(r.length){var i=this.input.value.split(" "),o=[];i.forEach(function(e,t){o.push(e),t===i.length-1&&n.indexOf(e.toLowerCase())!==-1&&o.pop()}),o.length>0&&gl.FilteredSearchVisualTokens.addSearchVisualToken(o.join(" ")),gl.FilteredSearchDropdownManager.addWordToInput(n.replace(":",""))}this.dismissDropdown(),this.dispatchInputEvent()}}},{key:"renderContent",value:function(){var e=[];[].forEach.call(this.input.closest(".filtered-search-input-container").querySelectorAll(".dropdown-menu"),function(t){var n=t.dataset,r=n.icon,i=n.hint,o=n.tag;r&&i&&o&&e.push({icon:"fa-"+r,hint:i,tag:"&lt;"+o+"&gt;"})}),this.droplab.changeHookList(this.hookId,this.dropdown,[droplabFilter],this.config),this.droplab.setData(this.hookId,e)}},{key:"init",value:function(){this.droplab.addHook(this.input,this.dropdown,[droplabFilter],this.config).init()}}]),t}(gl.FilteredSearchDropdown);window.gl=window.gl||{},gl.DropdownHint=e}()},"Z/Bu":function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();!function(){var e=function(){function e(){n(this,e)}return r(e,null,[{key:"getEscapedText",value:function(e){var t=e,n=e.indexOf(" ")!==-1,r=e.indexOf('"')!==-1;return n&&(t=r?"'"+e+"'":'"'+e+'"'),t}},{key:"filterWithSymbol",value:function(e,t,n){var r=n,i=gl.DropdownUtils.getSearchInput(t),o=r.title.toLowerCase(),a=i.toLowerCase(),l="";a[0]===e&&(l=a[0],a=a.slice(1)),'"'!==a[0]&&"'"!==a[0]||o.indexOf(" ")===-1||(a=a.slice(1));var s=l===e&&o.indexOf(a)!==-1,u=o.indexOf(""+l+a)!==-1;return r.droplab_hidden=!u&&!s,r}},{key:"filterHint",value:function(e,t){var n=t,r=gl.DropdownUtils.getSearchInput(e),i=gl.FilteredSearchTokenizer.processTokens(r),o=i.lastToken;if(o=o.key||o||"",o&&" "!==r.split("").last()){if(o){var a=o.split(":"),l=a[0].split(" ").last(),s=n.hint.indexOf(l.toLowerCase())===-1;n.droplab_hidden=!!l&&s}}else n.droplab_hidden=!1;return n}},{key:"setDataValueIfSelected",value:function(e,t){var n=t.getAttribute("data-value");return n&&gl.FilteredSearchDropdownManager.addWordToInput(e,n,!0),null!==n}},{key:"getSearchQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=[].slice.call(document.querySelectorAll(".tokens-container li")),n=[];if(e){var r=_.findIndex(t,function(e){return e.classList.contains("input-token")});t.splice(r+1)}return t.forEach(function(e){if(e.classList.contains("js-visual-token")){var t=e.querySelector(".name"),r=e.querySelector(".value"),i=r&&r.dataset.symbol?r.dataset.symbol:"",o="";r&&r.innerText&&(o=r.innerText),e.className.indexOf("filtered-search-token")!==-1?n.push(t.innerText.toLowerCase()+":"+i+o):n.push(t.innerText)}else if(e.classList.contains("input-token")){var a=gl.FilteredSearchVisualTokens.getLastVisualTokenBeforeInput(),l=a.isLastVisualTokenValid,s=document.querySelector(".filtered-search"),u=s&&s.value;if(l)n.push(u);else{var c=n.pop();n.push(""+c+u)}}}),n.join(" ")}},{key:"getSearchInput",value:function(e){var t=e.value,n=gl.DropdownUtils.getInputSelectionPosition(e),r=n.right;return t.slice(0,r)}},{key:"getInputSelectionPosition",value:function(e){var t=e.selectionStart,n=e.value;n=n.replace(/(('[^']*'{0,1})|("[^"]*"{0,1})|:\s+)/g,function(e){return e.replace(/\s/g,"_")});var r=n.slice(t).search(/\s/);r>=0?r+=t:r<0&&(r=n.length);var i=n.slice(0,r).search(/\S+$/);return 0===t?i=0:t===n.length&&i<0?i=n.length:i<0&&(i=t),{left:i,right:r}}}]),e}();window.gl=window.gl||{},gl.DropdownUtils=e}()},ZbqE:function(e,t,n){n("MxQn"),n("6Dwg"),n("jVBp"),n("Z/Bu"),n("tI+A"),n("noYj"),n("nyRt"),n("zrWn"),n("LrW2"),n("G85/")},jVBp:function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(r)};n("noYj"),function(){var e=function(e){function t(e,n,o,a){r(this,t);var l=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,o,a));return l.config={droplabAjaxFilter:{endpoint:(gon.relative_url_root||"")+"/autocomplete/users.json",searchKey:"search",params:{per_page:20,active:!0,project_id:l.getProjectId(),current_user:!0},searchValueFunction:l.getSearchInput.bind(l),loadingTemplate:l.loadingTemplate}},l}return o(t,e),a(t,[{key:"itemClicked",value:function(e){l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"itemClicked",this).call(this,e,function(e){return e.querySelector(".dropdown-light-content").innerText.trim()})}},{key:"renderContent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.droplab.changeHookList(this.hookId,this.dropdown,[droplabAjaxFilter],this.config),l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"renderContent",this).call(this,e)}},{key:"getProjectId",value:function(){return this.input.getAttribute("data-project-id")}},{key:"getSearchInput",value:function(){var e=gl.DropdownUtils.getSearchInput(this.input),t=gl.FilteredSearchTokenizer.processTokens(e),n=t.lastToken,r=n||"";return"@"===r[0]&&(r=r.slice(1)),'"'!==r[0]&&"'"!==r[0]||(r=r.slice(1)),r}},{key:"init",value:function(){this.droplab.addHook(this.input,this.dropdown,[droplabAjaxFilter],this.config).init()}}]),t}(gl.FilteredSearchDropdown);window.gl=window.gl||{},gl.DropdownUser=e}()},noYj:function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();!function(){var e="data-dropdown-trigger",t=function(){function t(e,r,i,o){n(this,t),this.droplab=e,this.hookId=i&&i.getAttribute("data-id"),this.input=i,this.filter=o,this.dropdown=r,this.loadingTemplate='<div class="filter-dropdown-loading">\n        <i class="fa fa-spinner fa-spin"></i>\n      </div>',this.bindEvents()}return r(t,[{key:"bindEvents",value:function(){this.itemClickedWrapper=this.itemClicked.bind(this),this.dropdown.addEventListener("click.dl",this.itemClickedWrapper)}},{key:"unbindEvents",value:function(){this.dropdown.removeEventListener("click.dl",this.itemClickedWrapper)}},{key:"getCurrentHook",value:function(){var e=this;return this.droplab.hooks.filter(function(t){return t.id===e.hookId})[0]||null}},{key:"itemClicked",value:function(e,t){var n=e.detail.selected;if("LI"===n.tagName&&n.innerHTML){var r=gl.DropdownUtils.setDataValueIfSelected(this.filter,n);if(!r){var i=t(n);gl.FilteredSearchDropdownManager.addWordToInput(this.filter,i,!0)}this.resetFilters(),this.dismissDropdown(),this.dispatchInputEvent()}}},{key:"setAsDropdown",value:function(){this.input.setAttribute(e,"#"+this.dropdown.id)}},{key:"setOffset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;window.innerWidth>480?this.dropdown.style.left=e+"px":this.dropdown.style.left="0px"}},{key:"renderContent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.getCurrentHook();e&&t&&t.list.hidden&&t.list.show()}},{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.setAsDropdown();var n=this.getCurrentHook(),r=null===n;r||e?this.renderContent(t):n.list.list.id!==this.dropdown.id&&this.renderContent(t)}},{key:"dismissDropdown",value:function(){this.input.focus()}},{key:"dispatchInputEvent",value:function(){this.input.dispatchEvent(new CustomEvent("input",{bubbles:!0,cancelable:!0}))}},{key:"dispatchFormSubmitEvent",value:function(){this.input.form.dispatchEvent(new Event("submit"))}},{key:"hideDropdown",value:function(){var e=this.getCurrentHook();e&&e.list.hide()}},{key:"resetFilters",value:function(){var e=this.getCurrentHook();if(e){var t=e.list.data||[],n=t.map(function(e){var t=e;return t.droplab_hidden=!1,t});e.list.render(n)}}}]),t}();window.gl=window.gl||{},gl.FilteredSearchDropdown=t}()},nyRt:function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();!function(){var e=function(){function e(t){n(this,e),this.filteredSearchInput=document.querySelector(".filtered-search"),this.clearSearchButton=document.querySelector(".clear-search"),this.tokensContainer=document.querySelector(".tokens-container"),this.filteredSearchTokenKeys=gl.FilteredSearchTokenKeys,this.filteredSearchInput&&(this.tokenizer=gl.FilteredSearchTokenizer,this.dropdownManager=new gl.FilteredSearchDropdownManager(this.filteredSearchInput.getAttribute("data-base-endpoint")||"",t),this.bindEvents(),this.loadSearchParamsFromURL(),this.dropdownManager.setDropdown(),this.cleanupWrapper=this.cleanup.bind(this),document.addEventListener("beforeunload",this.cleanupWrapper))}return r(e,[{key:"cleanup",value:function(){this.unbindEvents(),document.removeEventListener("beforeunload",this.cleanupWrapper)}},{key:"bindEvents",value:function(){this.handleFormSubmit=this.handleFormSubmit.bind(this),this.setDropdownWrapper=this.dropdownManager.setDropdown.bind(this.dropdownManager),this.toggleClearSearchButtonWrapper=this.toggleClearSearchButton.bind(this),this.handleInputPlaceholderWrapper=this.handleInputPlaceholder.bind(this),this.handleInputVisualTokenWrapper=this.handleInputVisualToken.bind(this),this.checkForEnterWrapper=this.checkForEnter.bind(this),this.clearSearchWrapper=this.clearSearch.bind(this),this.checkForBackspaceWrapper=this.checkForBackspace.bind(this),this.removeSelectedTokenWrapper=this.removeSelectedToken.bind(this),this.unselectEditTokensWrapper=this.unselectEditTokens.bind(this),this.editTokenWrapper=this.editToken.bind(this),this.tokenChange=this.tokenChange.bind(this),this.addInputContainerFocusWrapper=this.addInputContainerFocus.bind(this),this.removeInputContainerFocusWrapper=this.removeInputContainerFocus.bind(this),this.filteredSearchInput.form.addEventListener("submit",this.handleFormSubmit),this.filteredSearchInput.addEventListener("input",this.setDropdownWrapper),this.filteredSearchInput.addEventListener("input",this.toggleClearSearchButtonWrapper),this.filteredSearchInput.addEventListener("input",this.handleInputPlaceholderWrapper),this.filteredSearchInput.addEventListener("input",this.handleInputVisualTokenWrapper),this.filteredSearchInput.addEventListener("keydown",this.checkForEnterWrapper),this.filteredSearchInput.addEventListener("keyup",this.checkForBackspaceWrapper),this.filteredSearchInput.addEventListener("click",this.tokenChange),this.filteredSearchInput.addEventListener("keyup",this.tokenChange),this.filteredSearchInput.addEventListener("focus",this.addInputContainerFocusWrapper),this.tokensContainer.addEventListener("click",e.selectToken),this.tokensContainer.addEventListener("dblclick",this.editTokenWrapper),this.clearSearchButton.addEventListener("click",this.clearSearchWrapper),document.addEventListener("click",gl.FilteredSearchVisualTokens.unselectTokens),document.addEventListener("click",this.unselectEditTokensWrapper),document.addEventListener("click",this.removeInputContainerFocusWrapper),document.addEventListener("keydown",this.removeSelectedTokenWrapper)}},{key:"unbindEvents",value:function(){this.filteredSearchInput.form.removeEventListener("submit",this.handleFormSubmit),this.filteredSearchInput.removeEventListener("input",this.setDropdownWrapper),this.filteredSearchInput.removeEventListener("input",this.toggleClearSearchButtonWrapper),this.filteredSearchInput.removeEventListener("input",this.handleInputPlaceholderWrapper),this.filteredSearchInput.removeEventListener("input",this.handleInputVisualTokenWrapper),this.filteredSearchInput.removeEventListener("keydown",this.checkForEnterWrapper),this.filteredSearchInput.removeEventListener("keyup",this.checkForBackspaceWrapper),this.filteredSearchInput.removeEventListener("click",this.tokenChange),this.filteredSearchInput.removeEventListener("keyup",this.tokenChange),this.filteredSearchInput.removeEventListener("focus",this.addInputContainerFocusWrapper),this.tokensContainer.removeEventListener("click",e.selectToken),this.tokensContainer.removeEventListener("dblclick",this.editTokenWrapper),this.clearSearchButton.removeEventListener("click",this.clearSearchWrapper),document.removeEventListener("click",gl.FilteredSearchVisualTokens.unselectTokens),document.removeEventListener("click",this.unselectEditTokensWrapper),document.removeEventListener("click",this.removeInputContainerFocusWrapper),document.removeEventListener("keydown",this.removeSelectedTokenWrapper)}},{key:"checkForBackspace",value:function(e){if(8===e.keyCode||46===e.keyCode){var t=gl.FilteredSearchVisualTokens.getLastVisualTokenBeforeInput(),n=t.lastVisualToken;""===this.filteredSearchInput.value&&n&&(this.filteredSearchInput.value=gl.FilteredSearchVisualTokens.getLastTokenPartial(),gl.FilteredSearchVisualTokens.removeLastTokenPartial()),this.dropdownManager.updateCurrentDropdownOffset()}}},{key:"checkForEnter",value:function(e){if(38===e.keyCode||40===e.keyCode){var t=this.filteredSearchInput.selectionStart;e.preventDefault(),this.filteredSearchInput.setSelectionRange(t,t)}if(13===e.keyCode){var n=this.dropdownManager.mapping[this.dropdownManager.currentDropdown],r=n.element,i=r.querySelectorAll(".dropdown-active");e.preventDefault(),i.length||(this.dropdownManager.destroyDroplab(),this.search())}}},{key:"addInputContainerFocus",value:function(){var e=this.filteredSearchInput.closest(".filtered-search-input-container");e&&e.classList.add("focus")}},{key:"removeInputContainerFocus",value:function(e){var t=this.filteredSearchInput.closest(".filtered-search-input-container"),n=t&&t.contains(e.target),r=null!==e.target.closest(".filter-dropdown"),i=null!==e.target.closest("ul[data-dropdown]");n||r||i||!t||t.classList.remove("focus")}},{key:"unselectEditTokens",value:function(e){var t=document.querySelector(".filtered-search-input-container"),n=t&&t.contains(e.target),r=null!==e.target.closest(".filter-dropdown"),i=e.target.classList.contains("tokens-container");(!n&&!r||i)&&(gl.FilteredSearchVisualTokens.moveInputToTheRight(),this.dropdownManager.resetDropdowns())}},{key:"editToken",value:function(e){var t=e.target.closest(".js-visual-token");t&&(gl.FilteredSearchVisualTokens.editToken(t),this.tokenChange())}},{key:"toggleClearSearchButton",value:function(){var e=gl.DropdownUtils.getSearchQuery(),t="hidden",n=this.clearSearchButton.classList.contains(t);0!==e.length||n?e.length&&n&&this.clearSearchButton.classList.remove(t):this.clearSearchButton.classList.add(t)}},{key:"handleInputPlaceholder",value:function(){var e=gl.DropdownUtils.getSearchQuery(),t="Search or filter results...",n=this.filteredSearchInput.placeholder;0===e.length&&n!==t?this.filteredSearchInput.placeholder=t:e.length>0&&""!==n&&(this.filteredSearchInput.placeholder="")}},{key:"removeSelectedToken",value:function(e){8!==e.keyCode&&46!==e.keyCode||(gl.FilteredSearchVisualTokens.removeSelectedToken(),this.handleInputPlaceholder(),this.toggleClearSearchButton())}},{key:"clearSearch",value:function(e){e.preventDefault(),this.filteredSearchInput.value="";var t=[];[].forEach.call(this.tokensContainer.children,function(e){e.classList.contains("js-visual-token")&&t.push(e)}),t.forEach(function(e){e.parentElement.removeChild(e)}),this.clearSearchButton.classList.add("hidden"),this.handleInputPlaceholder(),this.dropdownManager.resetDropdowns()}},{key:"handleInputVisualToken",value:function(){var e=this.filteredSearchInput,t=gl.FilteredSearchTokenizer.processTokens(e.value),n=t.tokens,r=t.searchToken,i=gl.FilteredSearchVisualTokens.getLastVisualTokenBeforeInput(),o=i.isLastVisualTokenValid;if(o){n.forEach(function(t){e.value=e.value.replace(t.key+":"+t.symbol+t.value,""),gl.FilteredSearchVisualTokens.addFilterVisualToken(t.key,""+t.symbol+t.value)});var a=r.split(":");if(a.length>1){var l=a[0].split(" "),s=l.last();if(l.length>1){l.pop();var u=l.join(" ");e.value=e.value.replace(u,""),gl.FilteredSearchVisualTokens.addSearchVisualToken(u)}gl.FilteredSearchVisualTokens.addFilterVisualToken(s),e.value=e.value.replace(s+":","")}}else{var c=/([~%@]{0,1}".+")|([~%@]{0,1}'.+')|^((?![~%@]')(?![~%@]")(?!')(?!")).*/g;r.match(c)&&" "===e.value[e.value.length-1]&&(gl.FilteredSearchVisualTokens.addFilterVisualToken(r),e.value=e.value.replace(r,"").trim())}}},{key:"handleFormSubmit",value:function(e){e.preventDefault(),this.search()}},{key:"loadSearchParamsFromURL",value:function(){var e=this,t=gl.utils.getUrlParamsArray(),n=this.getUsernameParams(),r=!1;t.forEach(function(t){var i=t.split("="),o=decodeURIComponent(i[0]),a=i[1],l=e.filteredSearchTokenKeys.searchByConditionUrl(t);if(l)r=!0,gl.FilteredSearchVisualTokens.addFilterVisualToken(l.tokenKey,l.value);else{var s=a?decodeURIComponent(a.replace(/\+/g," ")):a,u=e.filteredSearchTokenKeys.searchByKeyParam(o);if(u){var c=o.indexOf("_"),d=c!==-1?o.slice(0,o.indexOf("_")):o,h=u.symbol,p="";s.indexOf(" ")!==-1&&(p=s.indexOf('"')===-1?'"':"'"),r=!0,gl.FilteredSearchVisualTokens.addFilterVisualToken(d,""+h+p+s+p)}else if(u||"assignee_id"!==o)if(u||"author_id"!==o)u||"search"!==o||(r=!0,e.filteredSearchInput.value=s);else{var f=parseInt(a,10);n[f]&&(r=!0,gl.FilteredSearchVisualTokens.addFilterVisualToken("author","@"+n[f]))}else{var v=parseInt(a,10);n[v]&&(r=!0,gl.FilteredSearchVisualTokens.addFilterVisualToken("assignee","@"+n[v]))}}}),r&&(this.clearSearchButton.classList.remove("hidden"),this.handleInputPlaceholder())}},{key:"search",value:function(){var e=this,t=[],n=this.tokenizer.processTokens(gl.DropdownUtils.getSearchQuery()),r=n.tokens,i=n.searchToken,o=gl.utils.getParameterByName("state")||"opened";if(t.push("state="+o),r.forEach(function(n){var r=e.filteredSearchTokenKeys.searchByConditionKeyValue(n.key,n.value.toLowerCase()),i=e.filteredSearchTokenKeys.searchByKey(n.key)||{},o=i.param,a=o?n.key+"_"+o:n.key,l="";if(r)l=r.url;else{var s=n.value;("'"===s[0]&&"'"===s[s.length-1]||'"'===s[0]&&'"'===s[s.length-1])&&(s=s.slice(1,s.length-1)),l=a+"="+encodeURIComponent(s)}t.push(l)}),i){var a=i.split(" ").map(function(e){return encodeURIComponent(e)}).join("+");t.push("search="+a)}var l="?scope=all&utf8=%E2%9C%93&"+t.join("&");gl.utils.visitUrl(l)}},{key:"getUsernameParams",value:function(){var e={};try{var t=this.filteredSearchInput.getAttribute("data-username-params");JSON.parse(t).forEach(function(t){e[t.id]=t.username})}catch(e){}return e}},{key:"tokenChange",value:function(){var e=this.dropdownManager.mapping[this.dropdownManager.currentDropdown];if(e){var t=e.reference;this.setDropdownWrapper(),t.dispatchInputEvent()}}}],[{key:"selectToken",value:function(e){var t=e.target.closest(".selectable");t&&(e.preventDefault(),e.stopPropagation(),gl.FilteredSearchVisualTokens.selectToken(t))}}]),e}();window.gl=window.gl||{},gl.FilteredSearchManager=e}()},"tI+A":function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();!function(){var e=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments[1];n(this,e),this.baseEndpoint=t.replace(/\/$/,""),this.tokenizer=gl.FilteredSearchTokenizer,this.filteredSearchTokenKeys=gl.FilteredSearchTokenKeys,this.filteredSearchInput=document.querySelector(".filtered-search"),this.page=r,this.setupMapping(),this.cleanupWrapper=this.cleanup.bind(this),document.addEventListener("beforeunload",this.cleanupWrapper)}return r(e,[{key:"cleanup",value:function(){this.droplab&&(this.droplab.destroy(),this.droplab=null),this.setupMapping(),document.removeEventListener("beforeunload",this.cleanupWrapper)}},{key:"setupMapping",value:function(){this.mapping={author:{reference:null,gl:"DropdownUser",element:document.querySelector("#js-dropdown-author")},assignee:{reference:null,gl:"DropdownUser",element:document.querySelector("#js-dropdown-assignee")},milestone:{reference:null,gl:"DropdownNonUser",extraArguments:[this.baseEndpoint+"/milestones.json","%"],element:document.querySelector("#js-dropdown-milestone")},label:{reference:null,gl:"DropdownNonUser",extraArguments:[this.baseEndpoint+"/labels.json","~"],element:document.querySelector("#js-dropdown-label")},hint:{reference:null,gl:"DropdownHint",element:document.querySelector("#js-dropdown-hint")}}}},{key:"updateCurrentDropdownOffset",value:function(){this.updateDropdownOffset(this.currentDropdown)}},{key:"updateDropdownOffset",value:function(e){var t=this.filteredSearchInput.getBoundingClientRect().left-document.querySelector(".scroll-container").getBoundingClientRect().left,n=240,r=this.mapping[e].element.clientWidth||n,i=document.querySelector(".scroll-container").clientWidth-r;i<t&&(t=i),this.mapping[e].reference.setOffset(t)}},{key:"load",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.mapping[e],r=n.gl,i=n.element,o=!1;if(!n.reference){var a=this.droplab,l=[null,a,i,this.filteredSearchInput,e],s=l.concat(n.extraArguments||[]);n.reference=new(Function.prototype.bind.apply(gl[r],s))}t&&n.reference.init(),"hint"===this.currentDropdown&&(o=!0),this.updateDropdownOffset(e),
n.reference.render(t,o),this.currentDropdown=e}},{key:"loadDropdown",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=!1;this.droplab||(t=!0,this.droplab=new DropLab);var n=this.filteredSearchTokenKeys.searchByKey(e.toLowerCase()),r=n&&this.currentDropdown!==n.key&&this.mapping[n.key],i=!n&&"hint"!==this.currentDropdown;if(r||i){var o=n&&n.key?n.key:"hint";this.load(o,t)}}},{key:"setDropdown",value:function(){var e=gl.DropdownUtils.getSearchQuery(!0),t=this.tokenizer.processTokens(e),n=t.lastToken,r=t.searchToken;if(this.currentDropdown&&this.updateCurrentDropdownOffset(),n===r&&null!==n){var i=n.split(":"),o=i[0].split(" ").last();this.loadDropdown(i.length>1?o:"")}else n?this.loadDropdown(n.key):this.loadDropdown("hint")}},{key:"resetDropdowns",value:function(){this.mapping[this.currentDropdown].reference.hideDropdown(),this.setDropdown(),this.mapping[this.currentDropdown].reference.resetFilters(),this.updateDropdownOffset(this.currentDropdown)}},{key:"destroyDroplab",value:function(){this.droplab.destroy()}}],[{key:"addWordToInput",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=document.querySelector(".filtered-search");gl.FilteredSearchVisualTokens.addFilterVisualToken(e,t),r.value="",n&&gl.FilteredSearchVisualTokens.moveInputToTheRight()}}]),e}();window.gl=window.gl||{},gl.FilteredSearchDropdownManager=e}()},zrWn:function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();!function(){var e=[{key:"author",type:"string",param:"username",symbol:"@"},{key:"assignee",type:"string",param:"username",symbol:"@"},{key:"milestone",type:"string",param:"title",symbol:"%"},{key:"label",type:"array",param:"name[]",symbol:"~"}],t=[{key:"label",type:"string",param:"name",symbol:"~"}],i=e.concat(t),o=[{url:"assignee_id=0",tokenKey:"assignee",value:"none"},{url:"milestone_title=No+Milestone",tokenKey:"milestone",value:"none"},{url:"milestone_title=%23upcoming",tokenKey:"milestone",value:"upcoming"},{url:"milestone_title=%23started",tokenKey:"milestone",value:"started"},{url:"label_name[]=No+Label",tokenKey:"label",value:"none"}],a=function(){function a(){n(this,a)}return r(a,null,[{key:"get",value:function(){return e}},{key:"getAlternatives",value:function(){return t}},{key:"getConditions",value:function(){return o}},{key:"searchByKey",value:function(t){return e.find(function(e){return e.key===t})||null}},{key:"searchBySymbol",value:function(t){return e.find(function(e){return e.symbol===t})||null}},{key:"searchByKeyParam",value:function(e){return i.find(function(t){var n=t.key;return t.param&&(n+="_"+t.param),e===n})||null}},{key:"searchByConditionUrl",value:function(e){return o.find(function(t){return t.url===e})||null}},{key:"searchByConditionKeyValue",value:function(e,t){return o.find(function(n){return n.tokenKey===e&&n.value===t})||null}}]),a}();window.gl=window.gl||{},gl.FilteredSearchTokenKeys=a}()}},["ZbqE"]);
//# sourceMappingURL=filtered_search.749a7c5ab2493583449c.bundle.js.map