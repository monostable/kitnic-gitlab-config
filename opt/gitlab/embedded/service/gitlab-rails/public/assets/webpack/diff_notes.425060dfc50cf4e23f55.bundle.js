webpackJsonp([4,25,26],{EuiY:function(s,e,t){(function(s){var e=t("Eruj");t("ZZAo"),t("epgj"),t("zKIA"),t("G+9o"),t("SVCF"),t("rK+X"),t("WYUY"),t("MU9e"),t("cRac"),t("tExy"),t("TP7M"),s(function(){var t=document.querySelector(".merge-request").dataset.projectPath,n="resolve-btn, resolve-discussion-btn, jump-to-discussion, comment-and-resolve-btn";window.gl=window.gl||{},window.gl.diffNoteApps={},window.ResolveService=new gl.DiffNotesResolveServiceClass(t),gl.diffNotesCompileComponents=function(){s("diff-note-avatars").each(function(){var t=e.extend({template:s(this).get(0).outerHTML}),n=(new t).$mount();s(this).replaceWith(n.$el)});var t=s(n).filter(function(){return 1!==s(this).closest("resolve-count").length});t&&t.each(function(){var t=s(this),n=t.attr(":note-id"),o=e.extend({template:t.get(0).outerHTML}),i=(new o).$mount();n&&(gl.diffNoteApps["note_"+n]=i),t.replaceWith(i.$el)})},gl.diffNotesCompileComponents(),new e({el:"#resolve-count-app",components:{"resolve-count":ResolveCount}})})}).call(e,t("lwLq"))},"G+9o":function(s,e,t){function n(s,e){if(!(s instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function s(s,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(s,n.key,n)}}return function(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}}(),i=window.Vue=t("Eruj");window.Vue.use(t("7UJR")),t("wFzz"),function(){window.gl=window.gl||{};var s=function(){function s(e){n(this,s),this.noteResource=i.resource(e+"/notes{/noteId}/resolve"),this.discussionResource=i.resource(e+"/merge_requests{/mergeRequestId}/discussions{/discussionId}/resolve")}return o(s,[{key:"resolve",value:function(s){return this.noteResource.save({noteId:s},{})}},{key:"unresolve",value:function(s){return this.noteResource.delete({noteId:s},{})}},{key:"toggleResolveForDiscussion",value:function(s,e){var t=CommentsStore.state[e],n=t.isResolved(),o=void 0;o=n?this.unResolveAll(s,e):this.resolveAll(s,e),o.then(function(s){if(t.loading=!1,200===s.status){var e=s.json(),o=e?e.resolved_by:null;n?t.unResolveAllNotes():t.resolveAllNotes(o),t.updateHeadline(e)}else new Flash("An error occurred when trying to resolve a discussion. Please try again.","alert")})}},{key:"resolveAll",value:function(s,e){var t=CommentsStore.state[e];return t.loading=!0,this.discussionResource.save({mergeRequestId:s,discussionId:e},{})}},{key:"unResolveAll",value:function(s,e){var t=CommentsStore.state[e];return t.loading=!0,this.discussionResource.delete({mergeRequestId:s,discussionId:e},{})}}]),s}();gl.DiffNotesResolveServiceClass=s}()},MU9e:function(s,e,t){(function(s){var e=t("Eruj");!function(){var t=e.extend({props:{noteId:Number,discussionId:String,resolved:Boolean,canResolve:Boolean,resolvedBy:String,authorName:String,authorAvatar:String,noteTruncated:String},data:function(){return{discussions:CommentsStore.state,loading:!1,note:{}}},watch:{discussions:{handler:"updateTooltip",deep:!0}},computed:{discussion:function(){return this.discussions[this.discussionId]},buttonText:function(){return this.isResolved?"Resolved by "+this.resolvedByName:this.canResolve?"Mark as resolved":"Unable to resolve"},isResolved:function(){return!!this.note&&this.note.resolved},resolvedByName:function(){return this.note.resolved_by}},methods:{updateTooltip:function(){var e=this;this.$nextTick(function(){s(e.$refs.button).tooltip("hide").tooltip("fixTitle")})},resolve:function(){var s=this;if(this.canResolve){var e=void 0;this.loading=!0,e=this.isResolved?ResolveService.unresolve(this.noteId):ResolveService.resolve(this.noteId),e.then(function(e){if(s.loading=!1,200===e.status){var t=e.json(),n=t?t.resolved_by:null;CommentsStore.update(s.discussionId,s.noteId,!s.isResolved,n),s.discussion.updateHeadline(t)}else new Flash("An error occurred when trying to resolve a comment. Please try again.","alert");s.updateTooltip()})}}},mounted:function(){s(this.$refs.button).tooltip({container:"body"})},beforeDestroy:function(){CommentsStore.delete(this.discussionId,this.noteId)},created:function(){CommentsStore.create({discussionId:this.discussionId,noteId:this.noteId,canResolve:this.canResolve,resolved:this.resolved,resolvedBy:this.resolvedBy,authorName:this.authorName,authorAvatar:this.authorAvatar,noteTruncated:this.noteTruncated}),this.note=this.discussion.getNote(this.noteId)}});e.component("resolve-btn",t)}()}).call(e,t("lwLq"))},SVCF:function(s,e){!function(s){s.DiscussionMixins={computed:{discussionCount:function(){return Object.keys(this.discussions).length},resolvedDiscussionCount:function(){var s=0;for(var e in this.discussions){var t=this.discussions[e];t.isResolved()&&(s+=1)}return s},unresolvedDiscussionCount:function(){var s=0;for(var e in this.discussions){var t=this.discussions[e];t.isResolved()||(s+=1)}return s}}}}(window)},TP7M:function(s,e,t){"use strict";(function(s){Object.defineProperty(e,"__esModule",{value:!0});var n=t("Eruj"),o=t.n(n),i=t("gL/p"),r=t.n(i);!function(){var e=o.a.extend({props:["discussionId"],data:function(){return{isVisible:!1,lineType:"",storeState:CommentsStore.state,shownAvatars:3,collapseIcon:r.a}},template:'\n      <div class="diff-comment-avatar-holders"\n        v-show="notesCount !== 0">\n        <div v-if="!isVisible">\n          <img v-for="note in notesSubset"\n            class="avatar diff-comment-avatar has-tooltip js-diff-comment-avatar"\n            width="19"\n            height="19"\n            role="button"\n            data-container="body"\n            data-placement="top"\n            :data-line-type="lineType"\n            :title="note.authorName + \': \' + note.noteTruncated"\n            :src="note.authorAvatar"\n            @click="clickedAvatar($event)" />\n          <span v-if="notesCount > shownAvatars"\n            class="diff-comments-more-count has-tooltip js-diff-comment-avatar"\n            data-container="body"\n            data-placement="top"\n            ref="extraComments"\n            role="button"\n            :data-line-type="lineType"\n            :title="extraNotesTitle"\n            @click="clickedAvatar($event)">{{ moreText }}</span>\n        </div>\n        <button class="diff-notes-collapse js-diff-comment-avatar"\n          type="button"\n          aria-label="Show comments"\n          :data-line-type="lineType"\n          @click="clickedAvatar($event)"\n          v-if="isVisible"\n          v-html="collapseIcon">\n        </button>\n      </div>\n    ',mounted:function(){var e=this;this.$nextTick(function(){e.addNoCommentClass(),e.setDiscussionVisible(),e.lineType=s(e.$el).closest(".diff-line-num").hasClass("old_line")?"old":"new"}),s(document).on("toggle.comments",function(){e.$nextTick(function(){e.setDiscussionVisible()})})},destroyed:function(){s(document).off("toggle.comments")},watch:{storeState:{handler:function(){var e=this;this.$nextTick(function(){s(".has-tooltip",e.$el).tooltip("fixTitle"),e.addNoCommentClass()})},deep:!0}},computed:{notesSubset:function(){var s=this,e=[];return this.discussion&&(e=Object.keys(this.discussion.notes).slice(0,this.shownAvatars).map(function(e){return s.discussion.notes[e]})),e},extraNotesTitle:function(){if(this.discussion){var s=this.discussion.notesCount()-this.shownAvatars;return s+" more comment"+(s>1?"s":"")}return""},discussion:function(){return this.storeState[this.discussionId]},notesCount:function(){return this.discussion?this.discussion.notesCount():0},moreText:function(){var s=this.notesCount<100?"+":"";return""+s+(this.notesCount-this.shownAvatars)}},methods:{clickedAvatar:function(e){var t=this;notes.addDiffNote(e),this.toggleDiscussionsToggleState(),this.$nextTick(function(){t.setDiscussionVisible(),s(".has-tooltip",t.$el).tooltip("fixTitle"),s(".has-tooltip",t.$el).tooltip("hide")})},addNoCommentClass:function(){var e=this.notesCount;s(this.$el).closest(".js-avatar-container").toggleClass("js-no-comment-btn",e>0).nextUntil(".js-avatar-container").toggleClass("js-no-comment-btn",e>0)},toggleDiscussionsToggleState:function(){var e=s(this.$el).closest(".code").find(".notes_holder"),t=e.filter(":visible"),n=s(this.$el).closest(".diff-file").find(".js-toggle-diff-comments");n.toggleClass("active",e.length===t.length)},setDiscussionVisible:function(){this.isVisible=s('.diffs .notes[data-discussion-id="'+this.discussion.id+'"]').is(":visible")}}});o.a.component("diff-note-avatars",e)}()}).call(e,t("lwLq"))},WYUY:function(s,e,t){(function(s){var e=t("Eruj");!function(){var t=e.extend({mixins:[DiscussionMixins],props:{discussionId:String},data:function(){return{discussions:CommentsStore.state,discussion:{}}},computed:{allResolved:function(){return 0===this.unresolvedDiscussionCount},showButton:function(){return this.discussionId?this.unresolvedDiscussionCount>1||this.discussionId!==this.lastResolvedId:this.unresolvedDiscussionCount>=1},lastResolvedId:function(){var s=void 0;for(var e in this.discussions){var t=this.discussions[e];t.isResolved()||(s=t.id)}return s}},methods:{jumpToNextUnresolvedDiscussion:function(){var e=void 0,t=void 0,n=void 0,o=void 0,i=window.mrTabs.currentAction,r=!0,u=!this.discussionId,a=function(e){return e.map(function(){return s(this).attr("data-discussion-id")}).toArray()},c=this.discussions;if("diffs"===i){e=".diffs .notes[data-discussion-id]",t=a(s(e));for(var d=0,l=0;l<t.length;l+=1){var v=t[l],h=c[v];h&&!h.isResolved()&&(d+=1)}this.discussionId&&!this.discussion.isResolved()?1===d&&(r=!1):0===d&&(r=!1)}else"notes"!==i&&(r=!1);r||(window.mrTabs.activateTab("notes"),i="notes",u=!0),"notes"===i&&(e=".discussion[data-discussion-id]",t=a(s(e)));for(var f=!1,m=0;m<t.length;m+=1){var p=t[m],g=c[p];if(g){if(!n&&!g.isResolved()&&(n=p,u))break;if(!u){if(f){if(g.isResolved())continue;o=p;break}p===this.discussionId&&(f=!0)}}}if(o=o||n){var C=s(e+'[data-discussion-id="'+o+'"]');if("notes"===i)C=C.closest(".note-discussion"),C.find(".js-toggle-content").is(":hidden")&&C.find(".js-toggle-button i").trigger("click");else if("diffs"===i){C.closest(".content").show(),C=C.closest("tr.notes_holder"),C.show();for(var w=void 0,b=0;b<4&&(w=C.prev(),w.hasClass("line_holder"));b+=1)C=w}s.scrollTo(C,{offset:0})}}},created:function(){this.discussion=this.discussions[this.discussionId]}});e.component("jump-to-discussion",t)}()}).call(e,t("lwLq"))},ZZAo:function(s,e,t){(function(s){function e(s,e){if(!(s instanceof e))throw new TypeError("Cannot call a class as a function")}var t=function(){function s(s,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(s,n.key,n)}}return function(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}}(),n=function(){function n(s){e(this,n),this.id=s,this.notes={},this.loading=!1,this.canResolve=!1}return t(n,[{key:"createNote",value:function(s){Vue.set(this.notes,s.noteId,new NoteModel(this.id,s))}},{key:"deleteNote",value:function(s){Vue.delete(this.notes,s)}},{key:"getNote",value:function(s){return this.notes[s]}},{key:"notesCount",value:function(){return Object.keys(this.notes).length}},{key:"isResolved",value:function(){for(var s in this.notes){var e=this.notes[s];if(!e.resolved)return!1}return!0}},{key:"resolveAllNotes",value:function(s){for(var e in this.notes){var t=this.notes[e];t.resolved||(t.resolved=!0,t.resolved_by=s)}}},{key:"unResolveAllNotes",value:function(){for(var s in this.notes){var e=this.notes[s];e.resolved&&(e.resolved=!1,e.resolved_by=null)}}},{key:"updateHeadline",value:function(e){var t='.discussion[data-discussion-id="'+this.id+'"]',n=s(t+" .js-discussion-headline");e.discussion_headline_html?(n.length?n.replaceWith(e.discussion_headline_html):s(t+" .discussion-header").append(e.discussion_headline_html),gl.utils.localTimeAgo(s(".js-timeago",""+t))):n.remove()}},{key:"isResolvable",value:function(){if(!this.canResolve)return!1;for(var s in this.notes){var e=this.notes[s];if(e.canResolve)return!0}return!1}}]),n}();window.DiscussionModel=n}).call(e,t("lwLq"))},cRac:function(s,e,t){var n=t("Eruj");!function(s){s.ResolveCount=n.extend({mixins:[DiscussionMixins],props:{loggedOut:Boolean},data:function(){return{discussions:CommentsStore.state}},computed:{allResolved:function(){return this.resolvedDiscussionCount===this.discussionCount},resolvedCountText:function(){return 1===this.discussionCount?"discussion":"discussions"}}})}(window)},epgj:function(s,e){function t(s,e){if(!(s instanceof e))throw new TypeError("Cannot call a class as a function")}var n=function s(e,n){t(this,s),this.discussionId=e,this.id=n.noteId,this.canResolve=n.canResolve,this.resolved=n.resolved,this.resolved_by=n.resolvedBy,this.authorName=n.authorName,this.authorAvatar=n.authorAvatar,this.noteTruncated=n.noteTruncated};window.NoteModel=n},"gL/p":function(s,e){s.exports='<svg width="11" height="11" viewBox="0 0 9 13"><path d="M2.57568253,6.49866948 C2.50548852,6.57199715 2.44637866,6.59708255 2.39835118,6.57392645 C2.3503237,6.55077034 2.32631032,6.48902165 2.32631032,6.38867852 L2.32631032,-2.13272614 C2.32631032,-2.23306927 2.3503237,-2.29481796 2.39835118,-2.31797406 C2.44637866,-2.34113017 2.50548852,-2.31604477 2.57568253,-2.24271709 L6.51022184,1.86747129 C6.53977721,1.8983461 6.56379059,1.93500939 6.5822627,1.97746225 L6.5822627,2.27849013 C6.56379059,2.31708364 6.53977721,2.35374693 6.51022184,2.38848109 L2.57568253,6.49866948 Z" transform="translate(4.454287, 2.127976) rotate(90.000000) translate(-4.454287, -2.127976) "></path><path d="M3.74312342,2.09553332 C3.74312342,1.99519019 3.77821989,1.9083561 3.8484139,1.83502843 C3.91860791,1.76170075 4.00173115,1.72503747 4.09778611,1.72503747 L4.80711151,1.72503747 C4.90316647,1.72503747 4.98628971,1.76170075 5.05648372,1.83502843 C5.12667773,1.9083561 5.16177421,1.99519019 5.16177421,2.09553332 L5.16177421,10.2464421 C5.16177421,10.3467853 5.12667773,10.4336194 5.05648372,10.506947 C4.98628971,10.5802747 4.90316647,10.616938 4.80711151,10.616938 L4.09778611,10.616938 C4.00173115,10.616938 3.91860791,10.5802747 3.8484139,10.506947 C3.77821989,10.4336194 3.74312342,10.3467853 3.74312342,10.2464421 L3.74312342,2.09553332 Z" transform="translate(4.452449, 6.170988) rotate(-90.000000) translate(-4.452449, -6.170988) "></path><path d="M2.57568253,14.6236695 C2.50548852,14.6969971 2.44637866,14.7220826 2.39835118,14.6989264 C2.3503237,14.6757703 2.32631032,14.6140216 2.32631032,14.5136785 L2.32631032,5.99227386 C2.32631032,5.89193073 2.3503237,5.83018204 2.39835118,5.80702594 C2.44637866,5.78386983 2.50548852,5.80895523 2.57568253,5.88228291 L6.51022184,9.99247129 C6.53977721,10.0233461 6.56379059,10.0600094 6.5822627,10.1024622 L6.5822627,10.4034901 C6.56379059,10.4420836 6.53977721,10.4787469 6.51022184,10.5134811 L2.57568253,14.6236695 Z" transform="translate(4.454287, 10.252976) scale(1, -1) rotate(90.000000) translate(-4.454287, -10.252976) "></path></svg>\n'},"rK+X":function(s,e,t){(function(s){var e=t("Eruj");!function(){var t=e.extend({props:{discussionId:String},data:function(){return{textareaIsEmpty:!0,discussion:{}}},computed:{showButton:function(){return!!this.discussion&&this.discussion.isResolvable()},isDiscussionResolved:function(){return this.discussion.isResolved()},buttonText:function(){return this.isDiscussionResolved?this.textareaIsEmpty?"Unresolve discussion":"Comment & unresolve discussion":this.textareaIsEmpty?"Resolve discussion":"Comment & resolve discussion"}},created:function(){this.discussion=CommentsStore.state[this.discussionId]},mounted:function(){var e=this,t=s("#new-discussion-note-form-"+this.discussionId+" .note-textarea");this.textareaIsEmpty=""===t.val(),t.on("input.comment-and-resolve-btn",function(){e.textareaIsEmpty=""===t.val()})},destroyed:function(){s("#new-discussion-note-form-"+this.discussionId+" .note-textarea").off("input.comment-and-resolve-btn")}});e.component("comment-and-resolve-btn",t)}(window)}).call(e,t("lwLq"))},tExy:function(s,e,t){var n=t("Eruj");!function(){var s=n.extend({props:{discussionId:String,mergeRequestId:Number,canResolve:Boolean},data:function(){return{discussion:{}}},computed:{showButton:function(){return!!this.discussion&&this.discussion.isResolvable()},isDiscussionResolved:function(){return!!this.discussion&&this.discussion.isResolved()},buttonText:function(){return this.isDiscussionResolved?"Unresolve discussion":"Resolve discussion"},loading:function(){return!!this.discussion&&this.discussion.loading}},methods:{resolve:function(){ResolveService.toggleResolveForDiscussion(this.mergeRequestId,this.discussionId)}},created:function(){CommentsStore.createDiscussion(this.discussionId,this.canResolve),this.discussion=CommentsStore.state[this.discussionId]}});n.component("resolve-discussion-btn",s)}()},zKIA:function(s,e){!function(s){s.CommentsStore={state:{},get:function(s,e){return this.state[s].getNote(e)},createDiscussion:function(s,e){var t=this.state[s];return this.state[s]||(t=new DiscussionModel(s),Vue.set(this.state,s,t)),void 0!==e&&(t.canResolve=e),t},create:function(s){var e=this.createDiscussion(s.discussionId);e.createNote(s)},update:function(s,e,t,n){var o=this.state[s],i=o.getNote(e);i.resolved=t,i.resolved_by=n},delete:function(s,e){var t=this.state[s];t.deleteNote(e),0===t.notesCount()&&Vue.delete(this.state,s)},unresolvedDiscussionIds:function(){var s=[];for(var e in this.state){var t=this.state[e];t.isResolved()||s.push(t.id)}return s}}}(window)}},["EuiY"]);
//# sourceMappingURL=diff_notes.425060dfc50cf4e23f55.bundle.js.map